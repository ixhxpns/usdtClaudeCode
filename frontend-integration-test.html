<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰å¾Œç«¯é›†æˆæ¸¬è©¦</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
            background-color: #f5f5f5;
        }
        .container { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-section { 
            border: 1px solid #ddd; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 4px; 
        }
        .success { 
            background-color: #d4edda; 
            border-color: #c3e6cb; 
            color: #155724; 
        }
        .error { 
            background-color: #f8d7da; 
            border-color: #f5c6cb; 
            color: #721c24; 
        }
        button { 
            background-color: #007bff; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px;
        }
        button:hover { 
            background-color: #0056b3; 
        }
        button:disabled { 
            background-color: #6c757d; 
            cursor: not-allowed; 
        }
        pre { 
            background-color: #f8f9fa; 
            padding: 10px; 
            border-radius: 4px; 
            overflow-x: auto; 
            white-space: pre-wrap;
            font-size: 12px;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background-color: #28a745; }
        .status-error { background-color: #dc3545; }
        .status-warning { background-color: #ffc107; }
        .status-pending { background-color: #6c757d; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”— USDTäº¤æ˜“å¹³å°å‰å¾Œç«¯é›†æˆæ¸¬è©¦</h1>
        <p>æœ¬æ¸¬è©¦é é¢é©—è­‰å‰ç«¯HTTPé…ç½®èˆ‡å¾Œç«¯APIçš„å®Œæ•´é€šä¿¡åŠŸèƒ½</p>
    </div>

    <div class="container">
        <h2>ğŸ“¡ é€£æ¥é…ç½®ä¿¡æ¯</h2>
        <div class="test-section">
            <h3>ç•¶å‰é…ç½®</h3>
            <ul>
                <li><strong>ç”¨æˆ¶å‰ç«¯:</strong> <span id="user-frontend-url">http://localhost:3001</span></li>
                <li><strong>ç®¡ç†å‰ç«¯:</strong> <span id="admin-frontend-url">http://localhost:3000</span></li>
                <li><strong>å¾Œç«¯API:</strong> <span id="backend-api-url">http://localhost:8085</span></li>
                <li><strong>APIè·¯å¾‘å‰ç¶´:</strong> <span id="api-prefix">/api/api</span></li>
                <li><strong>Nginxä»£ç†:</strong> <span id="nginx-url">http://localhost:80</span></li>
            </ul>
        </div>
    </div>

    <div class="container">
        <h2>ğŸ¥ å¥åº·æª¢æŸ¥æ¸¬è©¦</h2>
        <div class="test-section">
            <button onclick="testHealthCheck()">æ¸¬è©¦å¾Œç«¯å¥åº·ç‹€æ…‹</button>
            <div id="health-result"></div>
        </div>
    </div>

    <div class="container">
        <h2>ğŸ” èªè­‰ç³»çµ±æ¸¬è©¦</h2>
        <div class="test-section">
            <h3>ç™»éŒ„æ¸¬è©¦</h3>
            <input type="email" id="login-email" placeholder="æ¸¬è©¦éƒµç®±" value="test@example.com">
            <input type="password" id="login-password" placeholder="æ¸¬è©¦å¯†ç¢¼" value="testpass123">
            <button onclick="testLogin()">æ¸¬è©¦ç™»éŒ„</button>
            <div id="login-result"></div>
        </div>
        
        <div class="test-section">
            <h3>è¨»å†Šæ¸¬è©¦</h3>
            <input type="text" id="register-username" placeholder="ç”¨æˆ¶å" value="testuser">
            <input type="email" id="register-email" placeholder="éƒµç®±" value="test@example.com">
            <input type="password" id="register-password" placeholder="å¯†ç¢¼" value="testpass123">
            <button onclick="testRegister()">æ¸¬è©¦è¨»å†Š</button>
            <div id="register-result"></div>
        </div>
    </div>

    <div class="container">
        <h2>ğŸ’° äº¤æ˜“åŠŸèƒ½æ¸¬è©¦</h2>
        <div class="test-section">
            <button onclick="testPriceAPI()">æ¸¬è©¦åƒ¹æ ¼API</button>
            <div id="price-result"></div>
        </div>
        
        <div class="test-section">
            <button onclick="testWalletAPI()">æ¸¬è©¦éŒ¢åŒ…API</button>
            <div id="wallet-result"></div>
        </div>
    </div>

    <div class="container">
        <h2>ğŸ“„ æ–‡ä»¶ç³»çµ±æ¸¬è©¦</h2>
        <div class="test-section">
            <input type="file" id="file-upload" accept="image/*,.pdf,.doc,.docx">
            <button onclick="testFileUpload()">æ¸¬è©¦æ–‡ä»¶ä¸Šå‚³</button>
            <div id="file-upload-result"></div>
        </div>
    </div>

    <div class="container">
        <h2>ğŸš¨ éŒ¯èª¤è™•ç†æ¸¬è©¦</h2>
        <div class="test-section">
            <button onclick="testErrorHandling()">æ¸¬è©¦éŒ¯èª¤è™•ç†</button>
            <div id="error-handling-result"></div>
        </div>
    </div>

    <div class="container">
        <h2>ğŸŒ CORSé…ç½®æ¸¬è©¦</h2>
        <div class="test-section">
            <button onclick="testCORS()">æ¸¬è©¦è·¨åŸŸè«‹æ±‚</button>
            <div id="cors-result"></div>
        </div>
    </div>

    <script>
        // APIé…ç½®
        const API_BASE_URL = 'http://localhost:8085/api/api';
        let authToken = null;

        // HTTPå®¢æˆ¶ç«¯é…ç½® (æ¨¡æ“¬å‰ç«¯http.ts)
        const httpClient = {
            async request(method, url, options = {}) {
                const config = {
                    method: method.toUpperCase(),
                    headers: {
                        'Content-Type': 'application/json',
                        'User-Agent': 'Frontend-Integration-Test',
                        'X-Client-Version': '1.0.0',
                        'X-Request-ID': generateRequestId(),
                        ...options.headers
                    },
                    ...options
                };

                if (authToken) {
                    config.headers.Authorization = `Bearer ${authToken}`;
                }

                if (config.method !== 'GET' && options.body) {
                    config.body = typeof options.body === 'string' ? options.body : JSON.stringify(options.body);
                }

                try {
                    const response = await fetch(`${API_BASE_URL}${url}`, config);
                    const data = await response.json();
                    
                    return {
                        success: response.ok,
                        status: response.status,
                        data: data,
                        response: response
                    };
                } catch (error) {
                    return {
                        success: false,
                        status: 0,
                        error: error.message,
                        data: null
                    };
                }
            }
        };

        function generateRequestId() {
            return `test-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
        }

        function displayResult(elementId, result, title = '') {
            const element = document.getElementById(elementId);
            const status = result.success ? 'success' : 'error';
            const statusIcon = result.success ? 'âœ…' : 'âŒ';
            
            element.innerHTML = `
                <div class="${status}">
                    <h4>${statusIcon} ${title}</h4>
                    <p><strong>ç‹€æ…‹:</strong> ${result.status} ${result.success ? 'SUCCESS' : 'ERROR'}</p>
                    <pre>${JSON.stringify(result.data || result.error, null, 2)}</pre>
                </div>
            `;
        }

        // æ¸¬è©¦å‡½æ•¸
        async function testHealthCheck() {
            console.log('ğŸ¥ æ¸¬è©¦å¥åº·æª¢æŸ¥...');
            try {
                const result = await httpClient.request('GET', '/../../actuator/health');
                displayResult('health-result', result, 'å¥åº·æª¢æŸ¥çµæœ');
            } catch (error) {
                displayResult('health-result', { success: false, error: error.message }, 'å¥åº·æª¢æŸ¥å¤±æ•—');
            }
        }

        async function testLogin() {
            console.log('ğŸ” æ¸¬è©¦ç™»éŒ„åŠŸèƒ½...');
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            const result = await httpClient.request('POST', '/auth/login', {
                body: { email, password }
            });
            
            if (result.success && result.data.access_token) {
                authToken = result.data.access_token;
            }
            
            displayResult('login-result', result, 'ç™»éŒ„æ¸¬è©¦çµæœ');
        }

        async function testRegister() {
            console.log('ğŸ“ æ¸¬è©¦è¨»å†ŠåŠŸèƒ½...');
            const username = document.getElementById('register-username').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            
            const result = await httpClient.request('POST', '/auth/register', {
                body: { username, email, password }
            });
            
            displayResult('register-result', result, 'è¨»å†Šæ¸¬è©¦çµæœ');
        }

        async function testPriceAPI() {
            console.log('ğŸ’° æ¸¬è©¦åƒ¹æ ¼API...');
            const result = await httpClient.request('GET', '/price/current');
            displayResult('price-result', result, 'åƒ¹æ ¼APIæ¸¬è©¦çµæœ');
        }

        async function testWalletAPI() {
            console.log('ğŸ‘› æ¸¬è©¦éŒ¢åŒ…API...');
            if (!authToken) {
                displayResult('wallet-result', { success: false, error: 'éœ€è¦å…ˆç™»éŒ„' }, 'éŒ¢åŒ…APIæ¸¬è©¦å¤±æ•—');
                return;
            }
            
            const result = await httpClient.request('GET', '/wallet/balance');
            displayResult('wallet-result', result, 'éŒ¢åŒ…APIæ¸¬è©¦çµæœ');
        }

        async function testFileUpload() {
            console.log('ğŸ“„ æ¸¬è©¦æ–‡ä»¶ä¸Šå‚³...');
            const fileInput = document.getElementById('file-upload');
            const file = fileInput.files[0];
            
            if (!file) {
                displayResult('file-upload-result', { success: false, error: 'è«‹é¸æ“‡æ–‡ä»¶' }, 'æ–‡ä»¶ä¸Šå‚³å¤±æ•—');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            
            const result = await httpClient.request('POST', '/files/upload', {
                headers: { 'Content-Type': undefined }, // è®“ç€è¦½å™¨è‡ªå‹•è¨­ç½®
                body: formData
            });
            
            displayResult('file-upload-result', result, 'æ–‡ä»¶ä¸Šå‚³æ¸¬è©¦çµæœ');
        }

        async function testErrorHandling() {
            console.log('ğŸš¨ æ¸¬è©¦éŒ¯èª¤è™•ç†...');
            
            // æ¸¬è©¦404éŒ¯èª¤
            const result404 = await httpClient.request('GET', '/nonexistent');
            
            // æ¸¬è©¦400éŒ¯èª¤
            const result400 = await httpClient.request('POST', '/auth/login', {
                body: { invalid: 'data' }
            });
            
            // æ¸¬è©¦401éŒ¯èª¤
            const result401 = await httpClient.request('GET', '/auth/me', {
                headers: { Authorization: 'Bearer invalid-token' }
            });
            
            displayResult('error-handling-result', {
                success: true,
                data: {
                    test404: result404,
                    test400: result400,
                    test401: result401
                }
            }, 'éŒ¯èª¤è™•ç†æ¸¬è©¦çµæœ');
        }

        async function testCORS() {
            console.log('ğŸŒ æ¸¬è©¦CORSé…ç½®...');
            
            const result = await httpClient.request('OPTIONS', '/auth/login', {
                headers: {
                    'Access-Control-Request-Method': 'POST',
                    'Access-Control-Request-Headers': 'Content-Type,Authorization'
                }
            });
            
            displayResult('cors-result', result, 'CORSæ¸¬è©¦çµæœ');
        }

        // é é¢åŠ è¼‰æ™‚è‡ªå‹•åŸ·è¡ŒåŸºæœ¬æ¸¬è©¦
        window.onload = function() {
            console.log('ğŸš€ å‰å¾Œç«¯é›†æˆæ¸¬è©¦é é¢åŠ è¼‰å®Œæˆ');
            testHealthCheck();
        };
    </script>
</body>
</html>