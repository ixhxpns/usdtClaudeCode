var T=(V,b,u)=>new Promise((s,m)=>{var i=n=>{try{d(u.next(n))}catch(f){m(f)}},p=n=>{try{d(u.throw(n))}catch(f){m(f)}},d=n=>n.done?s(n.value):Promise.resolve(n.value).then(i,p);d((u=u.apply(V,b)).next())});/* empty css             *//* empty css                  *//* empty css                 */import"./el-form-item-l0sNRNKZ.js";/* empty css                 */import{k as z,ak as R,al as B,r as v,M as C,e as I,I as K,l as x,m as c,q as a,G as t,A as r,u as o,z as S,C as k,W as L,K as q}from"./vue-vendor-DL5bj91p.js";import{T as $,U as D,V as N,W as j,X as M,Y as F,Z as W,_ as G,$ as X,a0 as Y,L as Z}from"./element-plus--BWWjcce.js";import{u as H,_ as J}from"./index-CtT-RS4Y.js";const O={class:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-700 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8"},P={class:"max-w-md w-full space-y-8"},Q={class:"text-center"},ee={class:"mx-auto h-16 w-16 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg"},te={class:"bg-white rounded-xl shadow-2xl border border-slate-200"},se={class:"p-8"},oe={key:1,class:"text-center"},ae={key:2,class:"text-center"},le={key:0},re={key:1},ie={class:"bg-gray-50 px-8 py-4 rounded-b-xl border-t"},ne={class:"flex items-center text-xs text-gray-500"},de=5,ue=z({__name:"LoginView",setup(V){const b=R(),u=B(),s=H(),m=v(),i=C({username:"",password:"",mfa_code:""}),p=v(!1),d=v(),n=v(0),f={username:[{required:!0,message:"请输入管理员账号",trigger:"blur"},{min:3,message:"账号长度不能少于3位",trigger:"blur"}],password:[{required:!0,message:"请输入登录密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],mfa_code:[{validator:(w,e,l)=>{p.value&&(!e||e.length!==6)?l(new Error("请输入6位验证码")):l()},trigger:"blur"}]},g=()=>T(this,null,function*(){var w,e;if(m.value)try{yield m.value.validate(),yield s.login({username:i.username,password:i.password,mfa_code:i.mfa_code||void 0});const l=u.query.redirect||"/dashboard";b.push(l)}catch(l){console.error("管理员登录失败:",l),((w=l.message)!=null&&w.includes("MFA")||(e=l.message)!=null&&e.includes("双因子"))&&(p.value=!0,Z.warning("请输入双因子认证码"))}}),A=()=>{s.isLocked&&(n.value=Math.max(0,s.lockoutTime-Date.now())/1e3,n.value>0&&(d.value=setTimeout(A,1e3)))};return I(()=>{if(s.isAuthenticated){b.push("/dashboard");return}s.isLocked&&A()}),K(()=>{d.value&&clearTimeout(d.value)}),(w,e)=>{const l=D,h=j,y=N,E=W,U=G;return c(),x("div",O,[a("div",P,[a("div",Q,[a("div",ee,[t(l,{size:32,class:"text-white"},{default:r(()=>[t(o($))]),_:1})]),e[3]||(e[3]=a("h2",{class:"mt-6 text-3xl font-extrabold text-white"}," 管理后台登录 ",-1)),e[4]||(e[4]=a("p",{class:"mt-2 text-sm text-slate-300"}," USDT交易平台 - 管理控制面板 ",-1))]),a("div",te,[a("div",se,[t(o(X),{ref_key:"loginFormRef",ref:m,model:i,rules:f,class:"space-y-6",onSubmit:q(g,["prevent"])},{default:r(()=>[t(y,{prop:"username"},{default:r(()=>[e[5]||(e[5]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," 管理员账号 ",-1)),t(h,{modelValue:i.username,"onUpdate:modelValue":e[0]||(e[0]=_=>i.username=_),size:"large",placeholder:"请输入管理员账号","prefix-icon":o(M),disabled:o(s).isLoading,onKeyup:L(g,["enter"])},{prefix:r(()=>[t(l,{class:"text-gray-400"},{default:r(()=>[t(o(M))]),_:1})]),_:1},8,["modelValue","prefix-icon","disabled"])]),_:1}),t(y,{prop:"password"},{default:r(()=>[e[6]||(e[6]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," 登录密码 ",-1)),t(h,{modelValue:i.password,"onUpdate:modelValue":e[1]||(e[1]=_=>i.password=_),type:"password",size:"large",placeholder:"请输入登录密码","show-password":"",disabled:o(s).isLoading,onKeyup:L(g,["enter"])},{prefix:r(()=>[t(l,{class:"text-gray-400"},{default:r(()=>[t(o(F))]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),p.value?(c(),S(y,{key:0,prop:"mfa_code"},{default:r(()=>[e[7]||(e[7]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," 双因子认证码 ",-1)),t(h,{modelValue:i.mfa_code,"onUpdate:modelValue":e[2]||(e[2]=_=>i.mfa_code=_),size:"large",placeholder:"请输入6位验证码",maxlength:"6",disabled:o(s).isLoading,onKeyup:L(g,["enter"])},{prefix:r(()=>[t(l,{class:"text-gray-400"},{default:r(()=>[t(o(F))]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1})):k("",!0),o(s).loginAttempts>0?(c(),x("div",oe,[t(E,{title:`登录失败 ${o(s).loginAttempts} 次，剩余 ${de-o(s).loginAttempts} 次机会`,type:"warning",closable:!1,"show-icon":"",class:"mb-4"},null,8,["title"])])):k("",!0),o(s).isLocked?(c(),x("div",ae,[t(E,{title:`账户已锁定，请 ${Math.ceil(n.value/60)} 分钟后重试`,type:"error",closable:!1,"show-icon":"",class:"mb-4"},null,8,["title"])])):k("",!0),t(y,null,{default:r(()=>[t(U,{type:"primary",size:"large",class:"w-full h-12 font-medium",loading:o(s).isLoading,disabled:o(s).isLocked,onClick:g},{default:r(()=>[o(s).isLoading?(c(),x("span",re,"登录中...")):(c(),x("span",le,"登录管理后台"))]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model"])]),a("div",ie,[a("div",ne,[t(l,{class:"mr-2 text-amber-500"},{default:r(()=>[t(o(Y))]),_:1}),e[8]||(e[8]=a("span",null," 请妥善保管您的管理员账号信息，勿与他人共享 ",-1))])])]),e[9]||(e[9]=a("div",{class:"text-center"},[a("p",{class:"text-xs text-slate-400"}," © 2024 USDT交易平台. 管理后台系统 "),a("p",{class:"text-xs text-slate-400 mt-1"}," 如遇问题请联系系统管理员 ")],-1))])])}}}),ye=J(ue,[["__scopeId","data-v-7a3331cf"]]);export{ye as default};
