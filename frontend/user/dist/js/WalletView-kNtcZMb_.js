var w=(m,t,v)=>new Promise((o,T)=>{var h=e=>{try{n(v.next(e))}catch(i){T(i)}},u=e=>{try{n(v.throw(e))}catch(i){T(i)}},n=e=>e.done?o(e.value):Promise.resolve(e.value).then(h,u);n((v=v.apply(m,t)).next())});import{an as as,f as r,j as d,k as s,K as A,M as F,J as f,O as l,Q as ns,H as es,P as _,aj as x,Y as P,I as N,aT as ls,aA as M,r as b,_ as k,c as p,o as is}from"./vue-vendor-D1tpuXMX.js";import{_ as rs,b as y}from"./index-CNq4hTTw.js";import"./vendor-CPjYCZhe.js";import"./element-plus-BimyLctg.js";const ds={name:"WalletView",setup(){const m=b(!1),t=b(!1),v=b(!1),o=b(!1),T=b("TRC20"),h=b(""),u=k({twd:0,usdt:0}),n=k({buyPrice:0,sellPrice:0}),e=k({network:"",address:"",amount:""}),i=k({checked:!1,valid:!1}),g=k({min:1,max:1e3,dailyRemaining:5e3}),R=b([]),I=p(()=>u.twd+u.usdt*n.sellPrice),C=p(()=>{const a=S.find(c=>c.value===e.network);return a?a.withdrawFee:"0"}),L=p(()=>{const a=parseFloat(e.amount)||0,c=parseFloat(C.value)||0;return Math.max(0,a-c).toFixed(6)}),U=p(()=>e.network&&e.address&&i.valid&&e.amount&&parseFloat(e.amount)>=g.min&&parseFloat(e.amount)<=u.usdt&&!o.value),S=[{label:"TRC20 (TRON)",value:"TRC20",fee:"免費",withdrawFee:"2",confirmations:"1"},{label:"ERC20 (Ethereum)",value:"ERC20",fee:"高",withdrawFee:"15",confirmations:"12"},{label:"BSC (Binance Smart Chain)",value:"BSC",fee:"低",withdrawFee:"1",confirmations:"3"}],W=a=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0}).format(a||0),E=a=>parseFloat(a||0).toFixed(6),V=a=>new Date(a).toLocaleDateString("zh-TW"),B=a=>a.currency==="USDT"?E(a.amount):W(a.amount),O=a=>({DEPOSIT:"icon-arrow-down",WITHDRAW:"icon-arrow-up",BUY:"icon-plus",SELL:"icon-minus",TRANSFER_IN:"icon-arrow-down",TRANSFER_OUT:"icon-arrow-up"})[a]||"icon-transaction",j=a=>({DEPOSIT:"充值",WITHDRAW:"提現",BUY:"買入",SELL:"賣出",TRANSFER_IN:"轉入",TRANSFER_OUT:"轉出"})[a]||a,q=a=>["DEPOSIT","BUY","TRANSFER_IN"].includes(a)?"positive":"negative",Y=a=>["DEPOSIT","BUY","TRANSFER_IN"].includes(a)?"+":"-",z=a=>({PENDING:"處理中",PROCESSING:"確認中",COMPLETED:"已完成",FAILED:"失敗",CANCELLED:"已取消"})[a]||a,H=a=>{const c=S.find(os=>os.value===a);return c?c.confirmations:"1"},D=()=>w(this,null,function*(){if(!m.value){m.value=!0;try{const a=yield y.get("/wallet/balance");a.data.success&&Object.assign(u,a.data.data)}catch(a){console.error("刷新餘額失敗:",a)}finally{m.value=!1}}}),G=()=>w(this,null,function*(){try{const a=yield y.get("/price/current");a.data.success&&Object.assign(n,a.data.data)}catch(a){console.error("獲取價格失敗:",a)}}),Q=()=>w(this,null,function*(){try{const a=yield y.get("/wallet/address?currency=USDT");a.data.success&&(h.value=a.data.data.address)}catch(a){console.error("獲取充值地址失敗:",a)}}),J=()=>w(this,null,function*(){try{const a=yield y.get("/wallet/transactions?pageSize=10");a.data.success&&(R.value=a.data.data.records)}catch(a){console.error("獲取交易記錄失敗:",a)}}),K=()=>w(this,null,function*(){try{const a=yield y.get("/wallet/withdraw-info?currency=USDT");a.data.success&&Object.assign(g,a.data.data)}catch(a){console.error("獲取提現限額失敗:",a)}}),X=()=>w(this,null,function*(){if(!e.address||!e.network){i.checked=!1;return}try{const a=yield y.post("/wallet/validate-address",{address:e.address,network:e.network});i.checked=!0,i.valid=a.data.success&&a.data.data.valid}catch(a){i.checked=!0,i.valid=!1}}),Z=()=>{},$=()=>{const a=parseFloat(C.value)||0,c=Math.max(0,u.usdt-a);e.amount=c.toFixed(6)},ss=()=>w(this,null,function*(){try{yield navigator.clipboard.writeText(h.value),alert("地址已複製到剪貼板")}catch(a){console.error("複製失敗:",a)}}),ts=()=>w(this,null,function*(){if(U.value){o.value=!0;try{const a=yield y.post("/wallet/withdraw",{amount:parseFloat(e.amount),toAddress:e.address,network:e.network});a.data.success?(v.value=!1,Object.assign(e,{network:"",address:"",amount:""}),i.checked=!1,i.valid=!1,D(),alert("提現申請已提交，請等待審核")):alert("提現失敗: "+a.data.message)}catch(a){console.error("提現失敗:",a),alert("提現失敗，請稍後重試")}finally{o.value=!1}}});return is(()=>{D(),G(),Q(),J(),K()}),{refreshing:m,showDepositModal:t,showWithdrawModal:v,withdrawing:o,selectedNetwork:T,depositAddress:h,balances:u,currentPrice:n,withdrawForm:e,addressValidation:i,withdrawLimits:g,recentTransactions:R,totalValue:I,withdrawFeeAmount:C,actualReceiveAmount:L,canSubmitWithdraw:U,supportedNetworks:S,formatPrice:W,formatCrypto:E,formatTime:V,formatAmount:B,getTransactionIcon:O,getTransactionTypeText:j,getAmountClass:q,getAmountPrefix:Y,getStatusText:z,getConfirmations:H,refreshBalance:D,validateAddress:X,calculateWithdrawFee:Z,setMaxAmount:$,copyAddress:ss,submitWithdraw:ts}}},cs={class:"wallet-view"},us={class:"balance-section"},ms={class:"balance-card"},ws={class:"balance-header"},vs=["disabled"],fs={class:"balance-grid"},bs={class:"balance-item twd"},ys={class:"balance-info"},hs={class:"amount"},Ts={class:"equivalent"},ks={class:"balance-item usdt"},ps={class:"balance-info"},gs={class:"amount"},Cs={class:"equivalent"},Ss={class:"total-balance"},Ds={class:"total"},As={class:"action-section"},Fs={class:"action-grid"},_s={class:"transactions-section"},xs={class:"section-header"},Ns={key:0,class:"transactions-list"},Rs={class:"transaction-info"},Us={class:"transaction-type"},Ws={class:"transaction-time"},Es={class:"amount"},Ps={key:1,class:"no-transactions"},Ms={class:"modal-header"},Is={class:"modal-body"},Ls={class:"network-selector"},Vs={class:"network-options"},Bs=["onClick"],Os={class:"network-name"},js={class:"network-fee"},qs={class:"address-section"},Ys={class:"address-display"},zs={class:"address-text"},Hs={class:"qr-code"},Gs={class:"qr-placeholder"},Qs={class:"qr-address"},Js={class:"deposit-notes"},Ks={class:"modal-header"},Xs={class:"modal-body"},Zs={class:"form-group"},$s=["value"],st={class:"form-group"},tt={key:0,class:"address-validation"},ot={class:"form-group"},at={class:"amount-input"},nt={class:"balance-hint"},et={class:"fee-summary"},lt={class:"fee-item"},it={class:"fee-item"},rt={class:"withdraw-limits"},dt={class:"limit-item"},ct={class:"limit-item"},ut=["disabled"];function mt(m,t,v,o,T,h){const u=as("router-link");return d(),r("div",cs,[s("div",us,[s("div",ms,[s("div",ws,[t[20]||(t[20]=s("h2",null,"錢包餘額",-1)),s("button",{class:"refresh-btn",onClick:t[0]||(t[0]=(...n)=>o.refreshBalance&&o.refreshBalance(...n)),disabled:o.refreshing},[s("i",{class:f(["icon-refresh",{spinning:o.refreshing}])},null,2),t[19]||(t[19]=F(" 刷新 ",-1))],8,vs)]),s("div",fs,[s("div",bs,[t[22]||(t[22]=s("div",{class:"currency-icon"},[s("span",null,"$")],-1)),s("div",ys,[t[21]||(t[21]=s("div",{class:"currency"},"台幣 (TWD)",-1)),s("div",hs,l(o.formatPrice(o.balances.twd)),1),s("div",Ts,"≈ "+l(o.formatPrice(o.balances.twd)),1)])]),s("div",ks,[t[24]||(t[24]=s("div",{class:"currency-icon"},[s("span",null,"₮")],-1)),s("div",ps,[t[23]||(t[23]=s("div",{class:"currency"},"USDT",-1)),s("div",gs,l(o.formatCrypto(o.balances.usdt)),1),s("div",Cs,"≈ "+l(o.formatPrice(o.balances.usdt*o.currentPrice.sellPrice)),1)])])]),s("div",Ss,[t[25]||(t[25]=s("span",{class:"label"},"總資產價值",-1)),s("span",Ds,l(o.formatPrice(o.totalValue)),1)])])]),s("div",As,[s("div",Fs,[s("button",{class:"action-btn deposit",onClick:t[1]||(t[1]=n=>o.showDepositModal=!0)},[...t[26]||(t[26]=[s("i",{class:"icon-deposit"},null,-1),s("span",null,"充值",-1)])]),s("button",{class:"action-btn withdraw",onClick:t[2]||(t[2]=n=>o.showWithdrawModal=!0)},[...t[27]||(t[27]=[s("i",{class:"icon-withdraw"},null,-1),s("span",null,"提現",-1)])]),s("button",{class:"action-btn trade",onClick:t[3]||(t[3]=n=>m.$router.push("/trading"))},[...t[28]||(t[28]=[s("i",{class:"icon-trade"},null,-1),s("span",null,"交易",-1)])]),s("button",{class:"action-btn history",onClick:t[4]||(t[4]=n=>m.$router.push("/wallet/history"))},[...t[29]||(t[29]=[s("i",{class:"icon-history"},null,-1),s("span",null,"歷史",-1)])])])]),s("div",_s,[s("div",xs,[t[31]||(t[31]=s("h3",null,"最近交易",-1)),ns(u,{to:"/wallet/history",class:"view-all"},{default:es(()=>[...t[30]||(t[30]=[F("查看全部",-1)])]),_:1})]),o.recentTransactions.length>0?(d(),r("div",Ns,[(d(!0),r(_,null,x(o.recentTransactions,n=>(d(),r("div",{key:n.id,class:"transaction-item"},[s("div",{class:f(["transaction-icon",n.type.toLowerCase()])},[s("i",{class:f(o.getTransactionIcon(n.type))},null,2)],2),s("div",Rs,[s("div",Us,l(o.getTransactionTypeText(n.type)),1),s("div",Ws,l(o.formatTime(n.createdAt)),1)]),s("div",{class:f(["transaction-amount",o.getAmountClass(n.type)])},[s("div",Es,l(o.getAmountPrefix(n.type))+l(o.formatAmount(n)),1),s("div",{class:f(["status",n.status.toLowerCase()])},l(o.getStatusText(n.status)),3)],2)]))),128))])):(d(),r("div",Ps,[...t[32]||(t[32]=[s("p",null,"暫無交易記錄",-1)])]))]),o.showDepositModal?(d(),r("div",{key:0,class:"modal-overlay",onClick:t[8]||(t[8]=n=>o.showDepositModal=!1)},[s("div",{class:"modal deposit-modal",onClick:t[7]||(t[7]=P(()=>{},["stop"]))},[s("div",Ms,[t[33]||(t[33]=s("h3",null,"USDT 充值",-1)),s("button",{class:"close-btn",onClick:t[5]||(t[5]=n=>o.showDepositModal=!1)},"×")]),s("div",Is,[s("div",Ls,[t[34]||(t[34]=s("label",null,"選擇網絡",-1)),s("div",Vs,[(d(!0),r(_,null,x(o.supportedNetworks,n=>(d(),r("button",{key:n.value,class:f(["network-btn",{active:o.selectedNetwork===n.value}]),onClick:e=>o.selectedNetwork=n.value},[s("span",Os,l(n.label),1),s("span",js,"手續費: "+l(n.fee),1)],10,Bs))),128))])]),s("div",qs,[t[37]||(t[37]=s("label",null,"充值地址",-1)),s("div",Ys,[s("div",zs,l(o.depositAddress),1),s("button",{class:"copy-btn",onClick:t[6]||(t[6]=(...n)=>o.copyAddress&&o.copyAddress(...n))},[...t[35]||(t[35]=[s("i",{class:"icon-copy"},null,-1),F(" 複製 ",-1)])])]),s("div",Hs,[s("div",Gs,[t[36]||(t[36]=s("p",null,"QR 碼",-1)),s("p",Qs,l(o.depositAddress),1)])])]),s("div",Js,[t[40]||(t[40]=s("h4",null,"重要提醒",-1)),s("ul",null,[s("li",null,"僅支持 "+l(o.selectedNetwork)+" 網絡的 USDT 充值",1),t[38]||(t[38]=s("li",null,"最小充值金額: 1 USDT",-1)),s("li",null,"充值需要 "+l(o.getConfirmations(o.selectedNetwork))+" 個區塊確認",1),t[39]||(t[39]=s("li",null,"請勿向此地址充值其他幣種",-1))])])])])])):A("",!0),o.showWithdrawModal?(d(),r("div",{key:1,class:"modal-overlay",onClick:t[18]||(t[18]=n=>o.showWithdrawModal=!1)},[s("div",{class:"modal withdraw-modal",onClick:t[17]||(t[17]=P(()=>{},["stop"]))},[s("div",Ks,[t[41]||(t[41]=s("h3",null,"USDT 提現",-1)),s("button",{class:"close-btn",onClick:t[9]||(t[9]=n=>o.showWithdrawModal=!1)},"×")]),s("div",Xs,[s("div",Zs,[t[43]||(t[43]=s("label",null,"提現網絡",-1)),N(s("select",{"onUpdate:modelValue":t[10]||(t[10]=n=>o.withdrawForm.network=n)},[t[42]||(t[42]=s("option",{value:""},"選擇網絡",-1)),(d(!0),r(_,null,x(o.supportedNetworks,n=>(d(),r("option",{key:n.value,value:n.value},l(n.label)+" (手續費: "+l(n.withdrawFee)+") ",9,$s))),128))],512),[[ls,o.withdrawForm.network]])]),s("div",st,[t[44]||(t[44]=s("label",null,"提現地址",-1)),N(s("input",{"onUpdate:modelValue":t[11]||(t[11]=n=>o.withdrawForm.address=n),type:"text",placeholder:"請輸入 USDT 錢包地址",onBlur:t[12]||(t[12]=(...n)=>o.validateAddress&&o.validateAddress(...n))},null,544),[[M,o.withdrawForm.address]]),o.addressValidation.checked?(d(),r("div",tt,[s("span",{class:f(["validation-status",o.addressValidation.valid?"valid":"invalid"])},l(o.addressValidation.valid?"✓ 地址格式正確":"✗ 地址格式錯誤"),3)])):A("",!0)]),s("div",ot,[t[45]||(t[45]=s("label",null,"提現數量",-1)),s("div",at,[N(s("input",{"onUpdate:modelValue":t[13]||(t[13]=n=>o.withdrawForm.amount=n),type:"number",step:"0.000001",placeholder:"最少 1 USDT",onInput:t[14]||(t[14]=(...n)=>o.calculateWithdrawFee&&o.calculateWithdrawFee(...n))},null,544),[[M,o.withdrawForm.amount]]),s("button",{class:"max-btn",onClick:t[15]||(t[15]=(...n)=>o.setMaxAmount&&o.setMaxAmount(...n))},"全部")]),s("div",nt," 可用餘額: "+l(o.formatCrypto(o.balances.usdt))+" USDT ",1)]),s("div",et,[s("div",lt,[t[46]||(t[46]=s("span",null,"網絡手續費",-1)),s("span",null,l(o.withdrawFeeAmount)+" USDT",1)]),s("div",it,[t[47]||(t[47]=s("span",null,"實際到賬",-1)),s("span",null,l(o.actualReceiveAmount)+" USDT",1)])]),s("div",rt,[s("div",dt,[t[48]||(t[48]=s("span",null,"單筆限額",-1)),s("span",null,l(o.withdrawLimits.min)+" - "+l(o.withdrawLimits.max)+" USDT",1)]),s("div",ct,[t[49]||(t[49]=s("span",null,"日剩餘額度",-1)),s("span",null,l(o.withdrawLimits.dailyRemaining)+" USDT",1)])]),s("button",{class:"submit-btn",disabled:!o.canSubmitWithdraw,onClick:t[16]||(t[16]=(...n)=>o.submitWithdraw&&o.submitWithdraw(...n))},l(o.withdrawing?"提交中...":"確認提現"),9,ut)])])])):A("",!0)])}const ht=rs(ds,[["render",mt],["__scopeId","data-v-70b8d9dc"]]);export{ht as default};
