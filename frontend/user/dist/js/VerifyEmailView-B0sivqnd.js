var E=(L,h,g)=>new Promise((n,x)=>{var b=o=>{try{d(g.next(o))}catch(u){x(u)}},k=o=>{try{d(g.throw(o))}catch(u){x(u)}},d=o=>o.done?n(o.value):Promise.resolve(o.value).then(b,k);d((g=g.apply(L,h)).next())});import{E as C,h as K,y as O,s as Y,c as B,f as J,p as W,j as X,n as Z,x as ee,z as te,m as se,g as le,v as ae}from"./element-plus-BimyLctg.js";import{d as ne,aQ as oe,aR as ie,r as v,_ as I,c as q,o as re,f as z,j as y,Q as s,H as l,k as t,u as r,Y as de,G as D,K as U,M as w,O as ue,P as me}from"./vue-vendor-D1tpuXMX.js";import{u as fe,_ as ce}from"./index-CNq4hTTw.js";import{A as ge}from"./AuthLayout-BYquXUgD.js";import{V as pe}from"./VerificationCodeInput-C7bNLV10.js";import{a as ve}from"./validators-CjzGUDfk.js";import"./vendor-CPjYCZhe.js";const xe={class:"text-center"},_e={class:"inline-flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400"},ye={class:"text-gray-900 dark:text-white"},be={class:"space-y-6"},ke={class:"verification-progress"},Ee={class:"flex items-center justify-center mb-6"},we={class:"flex items-center space-x-4"},he={class:"flex items-center"},Ve={class:"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center"},Ce={class:"flex items-center"},ze={class:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center animate-pulse"},Re={class:"verification-input-section"},Fe={key:0,class:"text-center"},Ue={class:"inline-flex items-center space-x-2 text-green-600"},Le={key:0},Se={key:1},Te={class:"help-section"},je={class:"text-center"},Be={class:"mt-4"},Ie={class:"security-tip bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mt-4"},qe={class:"flex items-start space-x-2"},De={class:"text-center space-y-4"},Me={class:"text-sm text-gray-500 dark:text-gray-400"},Ne={class:"dialog-footer"},$e=ne({__name:"VerifyEmailView",setup(L){var T;const h=oe(),g=ie(),n=fe(),x=v(),b=v(),k=v(!1),d=v(!1),o=v(""),u=v(!1),R=v(!1),c=I({token:""}),p=I({currentEmail:((T=n.user)==null?void 0:T.email)||"",newEmail:""}),M=q(()=>{var m;const a=((m=n.user)==null?void 0:m.email)||"";if(!a)return"";const[e,i]=a.split("@");return e.length<=2?a:`${e[0]+"*".repeat(e.length-2)+e[e.length-1]}@${i}`}),N=q(()=>c.token.length===6&&!n.isLoading),$={token:[{required:!0,message:"请输入验证码",trigger:"blur"},{len:6,message:"验证码长度为6位",trigger:"blur"}]},A={newEmail:[{required:!0,message:"请输入新邮箱地址",trigger:"blur"},{validator:(a,e,i)=>{e&&!ve(e)?i(new Error("请输入有效的邮箱地址")):e===p.currentEmail?i(new Error("新邮箱不能与当前邮箱相同")):i()},trigger:"blur"}]},P=a=>{c.token=a,o.value="",a.length===6&&V()},S=()=>E(this,null,function*(){try{k.value=!0,yield n.sendEmailVerification(),o.value=""}catch(a){o.value=a.message||"发送验证码失败"}finally{k.value=!1}}),V=()=>E(this,null,function*(){if(x.value)try{yield x.value.validate(),yield n.verifyEmail(c.token),d.value=!0,o.value="",C.success("邮箱验证成功！"),setTimeout(()=>{F()},3e3)}catch(a){console.error("邮箱验证失败:",a),o.value=a.message||"验证失败，请重试",c.token=""}}),F=()=>{const a=g.query.redirect||"/dashboard";h.push(a)},Q=()=>E(this,null,function*(){if(b.value)try{yield b.value.validate(),R.value=!0,yield new Promise(a=>setTimeout(a,2e3)),C.success("邮箱更换成功，请重新进行验证"),u.value=!1,yield S()}catch(a){C.error(a.message||"更换邮箱失败")}finally{R.value=!1}});return re(()=>E(this,null,function*(){var e;if(n.isEmailVerified){C.info("您的邮箱已经验证过了"),F();return}if(!n.user){h.push("/login");return}const a=g.query.token;a&&a.length===6&&(c.token=a,yield V()),p.currentEmail=((e=n.user)==null?void 0:e.email)||""})),(a,e)=>{const i=K,_=J,m=X,G=ee,j=le,H=ae;return y(),z(me,null,[s(ge,{"form-title":"验证您的邮箱","form-subtitle":"我们已向您的邮箱发送了验证码",loading:r(n).isLoading,"loading-text":"验证中，请稍候..."},{navigation:l(()=>[t("div",xe,[t("div",_e,[s(i,{size:16,class:"text-blue-500"},{default:l(()=>[s(r(se))]),_:1}),e[6]||(e[6]=t("span",null,"验证码已发送至",-1)),t("strong",ye,ue(M.value),1)])])]),footer:l(()=>[t("div",De,[t("div",Me,[e[18]||(e[18]=t("span",null,"需要帮助？",-1)),s(m,{type:"text",size:"small",class:"text-blue-600 hover:text-blue-500 ml-1"},{default:l(()=>[...e[17]||(e[17]=[w(" 联系客服 ",-1)])]),_:1})]),e[19]||(e[19]=t("div",{class:"text-xs text-gray-400 dark:text-gray-500"},[t("p",null,"© 2024 USDT Trading. 保留所有权利.")],-1))])]),default:l(()=>[t("div",be,[t("div",ke,[t("div",Ee,[t("div",we,[t("div",he,[t("div",Ve,[s(i,{size:16,class:"text-white"},{default:l(()=>[s(r(O))]),_:1})]),e[7]||(e[7]=t("span",{class:"ml-2 text-sm text-green-600 font-medium"},"邮件已发送",-1))]),e[9]||(e[9]=t("div",{class:"w-8 h-0.5 bg-gray-300 dark:bg-gray-600"},null,-1)),t("div",Ce,[t("div",ze,[s(i,{size:16,class:"text-white"},{default:l(()=>[s(r(Y))]),_:1})]),e[8]||(e[8]=t("span",{class:"ml-2 text-sm text-blue-600 font-medium"},"验证邮箱",-1))])])])]),t("div",Re,[s(r(B),{ref_key:"verifyFormRef",ref:x,model:c,rules:$,onSubmit:de(V,["prevent"])},{default:l(()=>[s(_,{prop:"token"},{default:l(()=>[e[11]||(e[11]=t("label",{class:"form-label text-center block mb-4"}," 请输入6位验证码 ",-1)),s(pe,{modelValue:c.token,"onUpdate:modelValue":e[0]||(e[0]=f=>c.token=f),length:6,disabled:r(n).isLoading||d.value,error:o.value,"show-resend":!0,"resend-countdown":60,resending:k.value,hint:"请输入发送到您邮箱的6位验证码",onComplete:P,onResend:S,class:"mb-6"},null,8,["modelValue","disabled","error","resending"]),d.value?(y(),z("div",Fe,[t("div",Ue,[s(i,{size:20},{default:l(()=>[s(r(W))]),_:1}),e[10]||(e[10]=t("span",{class:"font-medium"},"邮箱验证成功！",-1))])])):U("",!0)]),_:1}),d.value?U("",!0):(y(),D(_,{key:0},{default:l(()=>[s(m,{type:"primary",size:"large",class:"w-full verify-button",loading:r(n).isLoading,disabled:!N.value,onClick:V},{loading:l(()=>[s(i,{class:"animate-spin"},{default:l(()=>[s(r(Z))]),_:1})]),default:l(()=>[r(n).isLoading?(y(),z("span",Se,"验证中...")):(y(),z("span",Le,"验证邮箱"))]),_:1},8,["loading","disabled"])]),_:1})),d.value?(y(),D(_,{key:1},{default:l(()=>[s(m,{type:"success",size:"large",class:"w-full",onClick:F},{default:l(()=>[...e[12]||(e[12]=[w(" 继续到仪表板 ",-1)])]),_:1})]),_:1})):U("",!0)]),_:1},8,["model"])]),t("div",Te,[s(G,{class:"bg-gray-50 dark:bg-gray-800 border-0"},{default:l(()=>[t("div",je,[e[14]||(e[14]=t("h4",{class:"text-sm font-medium text-gray-900 dark:text-white mb-3"}," 未收到验证码？ ",-1)),e[15]||(e[15]=t("div",{class:"space-y-2 text-xs text-gray-600 dark:text-gray-400"},[t("p",null,"• 请检查您的垃圾邮件文件夹"),t("p",null,"• 验证码有效期为10分钟"),t("p",null,"• 如果仍未收到，请点击重新发送")],-1)),t("div",Be,[s(m,{type:"text",size:"small",onClick:e[1]||(e[1]=f=>u.value=!0),class:"text-blue-600 hover:text-blue-500"},{default:l(()=>[...e[13]||(e[13]=[w(" 更换邮箱地址 ",-1)])]),_:1})])])]),_:1}),t("div",Ie,[t("div",qe,[s(i,{class:"text-blue-600 mt-0.5",size:16},{default:l(()=>[s(r(te))]),_:1}),e[16]||(e[16]=t("div",null,[t("h4",{class:"text-sm font-medium text-blue-900 dark:text-blue-100 mb-1"}," 安全提示 "),t("div",{class:"text-xs text-blue-800 dark:text-blue-200 space-y-1"},[t("p",null,"• 请勿将验证码分享给他人"),t("p",null,"• 如非本人操作，请立即联系客服"),t("p",null,"• 验证完成后将自动启用邮箱安全功能")])],-1))])])])])]),_:1},8,["loading"]),s(H,{modelValue:u.value,"onUpdate:modelValue":e[5]||(e[5]=f=>u.value=f),title:"更换邮箱地址",width:"90%",style:{"max-width":"500px"},"close-on-click-modal":!1},{footer:l(()=>[t("div",Ne,[s(m,{onClick:e[4]||(e[4]=f=>u.value=!1)},{default:l(()=>[...e[21]||(e[21]=[w(" 取消 ",-1)])]),_:1}),s(m,{type:"primary",loading:R.value,onClick:Q},{default:l(()=>[...e[22]||(e[22]=[w(" 确认更换 ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[s(r(B),{ref_key:"changeEmailFormRef",ref:b,model:p,rules:A,"label-width":"80px"},{default:l(()=>[s(_,{label:"当前邮箱",prop:"currentEmail"},{default:l(()=>[s(j,{modelValue:p.currentEmail,"onUpdate:modelValue":e[2]||(e[2]=f=>p.currentEmail=f),disabled:"",size:"large"},null,8,["modelValue"])]),_:1}),s(_,{label:"新邮箱",prop:"newEmail"},{default:l(()=>[s(j,{modelValue:p.newEmail,"onUpdate:modelValue":e[3]||(e[3]=f=>p.newEmail=f),type:"email",size:"large",placeholder:"请输入新的邮箱地址"},null,8,["modelValue"])]),_:1}),e[20]||(e[20]=t("div",{class:"text-xs text-gray-500 mb-4"}," 注意：更换邮箱后需要重新进行邮箱验证 ",-1))]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),Je=ce($e,[["__scopeId","data-v-bbc4667d"]]);export{Je as default};
