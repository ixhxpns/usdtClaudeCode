var Ce=Object.defineProperty,Ve=Object.defineProperties;var we=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var Ee=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable;var $=(c,f,d)=>f in c?Ce(c,f,{enumerable:!0,configurable:!0,writable:!0,value:d}):c[f]=d,X=(c,f)=>{for(var d in f||(f={}))Ee.call(f,d)&&$(c,d,f[d]);if(W)for(var d of W(f))Be.call(f,d)&&$(c,d,f[d]);return c},Z=(c,f)=>Ve(c,we(f));var N=(c,f,d)=>new Promise((p,B)=>{var F=v=>{try{y(d.next(v))}catch(R){B(R)}},P=v=>{try{y(d.throw(v))}catch(R){B(R)}},y=v=>v.done?p(v.value):Promise.resolve(v.value).then(F,P);y((d=d.apply(c,f)).next())});import{a8 as Te,a7 as De,c as Fe,f as Pe,g as Re,Z as Se,_ as Ne,X as Ue,k as Ye,T as Ie,h as Ke,F as L,H as Me,j as ze,p as Ae,x as Oe,ab as je,ac as Le,S as qe,i as Ge,af as He,E as u,a1 as Je}from"./element-plus-BimyLctg.js";import{d as Qe,aQ as We,r as g,_ as $e,c as h,o as Xe,f as k,j as n,k as s,Q as t,H as l,K as U,P as Ze,aj as he,G as m,u as D,M as i,O as E}from"./vue-vendor-D1tpuXMX.js";import{s as et,a as tt}from"./kyc-C9ZWcgtY.js";import{a as lt,_ as st}from"./index-CNq4hTTw.js";import"./vendor-CPjYCZhe.js";const at={class:"kyc-submit-view"},ot={class:"mt-6"},rt={class:"mt-8"},it={key:0,class:"form-step"},nt={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},dt={key:1,class:"form-step"},ut={class:"space-y-6"},ft={class:"upload-section"},pt={class:"upload-section"},mt={class:"upload-section"},ct={class:"upload-section"},gt={key:2,class:"form-step"},vt={class:"text-center py-8"},yt={class:"face-recognition-container"},_t={key:0,class:"space-y-6"},bt={class:"face-icon"},kt={key:1,class:"space-y-4"},xt={class:"face-success"},Ct={key:3,class:"form-step"},Vt={class:"space-y-6"},wt={class:"space-y-3"},Et={class:"flex items-center justify-between"},Bt={class:"flex items-center justify-between"},Tt={class:"flex items-center justify-between"},Dt={class:"flex items-center justify-between"},Ft={class:"flex items-center justify-between"},Pt={class:"mt-8 flex justify-between"},Rt={class:"space-x-3"},St=Qe({__name:"KYCSubmitView",setup(c){const f=We(),d=g(),p=g(0),B=g(!1),F=g(!1),P=g(!1),y=g(!1),v=g(!1),R=g([]),ee=g([]),te=g([]),le=g([]),o=$e({fullName:"",gender:"",dateOfBirth:"",nationality:"",idType:"",idNumber:"",address:"",idCardFront:"",idCardBack:"",selfie:"",addressProof:""}),se={fullName:[{required:!0,message:"请输入姓名",trigger:"blur"},{min:2,max:50,message:"姓名长度在 2 到 50 个字符",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"change"}],dateOfBirth:[{required:!0,message:"请选择出生日期",trigger:"change"}],nationality:[{required:!0,message:"请选择国籍",trigger:"change"}],idType:[{required:!0,message:"请选择证件类型",trigger:"change"}],idNumber:[{required:!0,message:"请输入证件号码",trigger:"blur"},{min:6,max:30,message:"证件号码长度在 6 到 30 个字符",trigger:"blur"}],address:[{required:!0,message:"请输入地址",trigger:"blur"},{min:10,max:200,message:"地址长度在 10 到 200 个字符",trigger:"blur"}]},H=g([{code:"CN",name:"中国"},{code:"US",name:"美国"},{code:"JP",name:"日本"},{code:"KR",name:"韩国"},{code:"SG",name:"新加坡"},{code:"HK",name:"香港"},{code:"TW",name:"台湾"}]),Y="undefined/api/kyc/upload",I=h(()=>({Authorization:`Bearer ${lt()}`})),J=h(()=>o.idCardFront&&o.idCardBack&&o.selfie&&y.value&&v.value),ae=a=>{const e=new Date;return e.setFullYear(e.getFullYear()-18),a.getTime()>Date.now()||a.getTime()>e.getTime()},K=a=>{const e=a.type.startsWith("image/")||a.type==="application/pdf",_=a.size/1024/1024<5;return e?_?!0:(u.error("文件大小不能超过 5MB!"),!1):(u.error("只能上传图片或PDF文件!"),!1)},M=(a,e,_)=>{a.success?(o[_]=a.data.fileUrl,u.success("文件上传成功")):u.error(a.message||"文件上传失败")},z=a=>{console.error("上传失败:",a),u.error("文件上传失败，请重试")},A=(a,e)=>{o[e]=""},oe=()=>N(this,null,function*(){try{P.value=!0,yield new Promise(a=>setTimeout(a,3e3)),y.value=!0,u.success("人脸识别验证成功")}catch(a){u.error("人脸识别失败，请重试")}finally{P.value=!1}}),re=()=>N(this,null,function*(){if(p.value===0){if(!(yield d.value.validate().catch(()=>!1)))return}else if(p.value===1){if(!o.idCardFront||!o.idCardBack||!o.selfie){u.warning("请上传必需的证件文件");return}}else if(p.value===2&&!y.value){u.warning("请完成人脸识别验证");return}p.value++}),ie=()=>{p.value>0&&p.value--},ne=()=>N(this,null,function*(){try{F.value=!0;const a=yield et(o);a.data.success?u.success("草稿已保存"):u.error(a.data.message||"保存草稿失败")}catch(a){console.error("保存草稿失败:",a),u.error("保存草稿失败，请重试")}finally{F.value=!1}}),de=()=>N(this,null,function*(){if(!J.value){u.warning("请完成所有必需步骤");return}try{if(!(yield Je.confirm("提交后将无法修改，确认提交KYC申请吗？","确认提交",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})))return;B.value=!0;const e=yield tt(Z(X({},o),{faceVerified:y.value}));e.data.success?(u.success("KYC申请提交成功"),f.push("/kyc/status")):u.error(e.data.message||"KYC申请提交失败")}catch(a){a!=="cancel"&&(console.error("提交KYC失败:",a),u.error("提交失败，请重试"))}finally{B.value=!1}}),ue=a=>({male:"男",female:"女",other:"其他"})[a]||a,fe=a=>{const e=H.value.find(_=>_.code===a);return(e==null?void 0:e.name)||a},pe=a=>({ID_CARD:"身份证",PASSPORT:"护照",DRIVER_LICENSE:"驾驶证"})[a]||a,me=a=>a.length<=6?a:a.slice(0,3)+"****"+a.slice(-3),ce=()=>{u.info("服务条款页面开发中")},ge=()=>{u.info("隐私政策页面开发中")};return Xe(()=>{}),(a,e)=>{const _=Te,ve=De,q=Re,x=Pe,C=Ne,G=Se,ye=Ue,_e=Ye,T=Ke,O=Ie,S=ze,V=Le,be=je,j=Oe,b=qe,Q=He,ke=Ge,xe=Fe;return n(),k("div",at,[e[48]||(e[48]=s("div",{class:"page-header"},[s("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"提交 KYC 验证"),s("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," 完成身份验证以使用完整的交易功能 ")],-1)),s("div",ot,[t(ve,{active:p.value,"finish-status":"success","align-center":""},{default:l(()=>[t(_,{title:"个人信息",description:"填写基本信息"}),t(_,{title:"身份证明",description:"上传身份证件"}),t(_,{title:"人脸识别",description:"完成人脸验证"}),t(_,{title:"提交审核",description:"等待审核结果"})]),_:1},8,["active"])]),s("div",rt,[t(j,null,{default:l(()=>[t(xe,{ref_key:"formRef",ref:d,model:o,rules:se,"label-width":"120px","label-position":"left",size:"large"},{default:l(()=>[p.value===0?(n(),k("div",it,[e[8]||(e[8]=s("h2",{class:"step-title"},"个人基本信息",-1)),s("div",nt,[t(x,{label:"姓名",prop:"fullName"},{default:l(()=>[t(q,{modelValue:o.fullName,"onUpdate:modelValue":e[0]||(e[0]=r=>o.fullName=r),placeholder:"请输入真实姓名",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(x,{label:"性别",prop:"gender"},{default:l(()=>[t(G,{modelValue:o.gender,"onUpdate:modelValue":e[1]||(e[1]=r=>o.gender=r),placeholder:"请选择性别"},{default:l(()=>[t(C,{label:"男",value:"male"}),t(C,{label:"女",value:"female"}),t(C,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),t(x,{label:"出生日期",prop:"dateOfBirth"},{default:l(()=>[t(ye,{modelValue:o.dateOfBirth,"onUpdate:modelValue":e[2]||(e[2]=r=>o.dateOfBirth=r),type:"date",placeholder:"请选择出生日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD","disabled-date":ae,class:"w-full"},null,8,["modelValue"])]),_:1}),t(x,{label:"国籍",prop:"nationality"},{default:l(()=>[t(G,{modelValue:o.nationality,"onUpdate:modelValue":e[3]||(e[3]=r=>o.nationality=r),placeholder:"请选择国籍",filterable:""},{default:l(()=>[(n(!0),k(Ze,null,he(H.value,r=>(n(),m(C,{key:r.code,label:r.name,value:r.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(x,{label:"证件类型",prop:"idType"},{default:l(()=>[t(G,{modelValue:o.idType,"onUpdate:modelValue":e[4]||(e[4]=r=>o.idType=r),placeholder:"请选择证件类型"},{default:l(()=>[t(C,{label:"身份证",value:"ID_CARD"}),t(C,{label:"护照",value:"PASSPORT"}),t(C,{label:"驾驶证",value:"DRIVER_LICENSE"})]),_:1},8,["modelValue"])]),_:1}),t(x,{label:"证件号码",prop:"idNumber"},{default:l(()=>[t(q,{modelValue:o.idNumber,"onUpdate:modelValue":e[5]||(e[5]=r=>o.idNumber=r),placeholder:"请输入证件号码",maxlength:"30","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(x,{label:"地址",prop:"address",class:"md:col-span-2"},{default:l(()=>[t(q,{modelValue:o.address,"onUpdate:modelValue":e[6]||(e[6]=r=>o.address=r),type:"textarea",placeholder:"请输入详细地址",rows:3,maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})])])):U("",!0),p.value===1?(n(),k("div",dt,[e[16]||(e[16]=s("h2",{class:"step-title"},"身份证明文件",-1)),t(_e,{title:"上传要求",type:"info",closable:!1,class:"mb-6"},{default:l(()=>[...e[9]||(e[9]=[s("ul",{class:"list-disc list-inside space-y-1 text-sm"},[s("li",null,"文件格式：JPG、PNG、PDF，大小不超过5MB"),s("li",null,"图片清晰，四角完整，无遮挡"),s("li",null,"证件信息清晰可见，无反光"),s("li",null,"手持证件照请确保人脸和证件都清晰可见")],-1)])]),_:1}),s("div",ut,[s("div",ft,[e[10]||(e[10]=s("h3",{class:"upload-title"},"身份证正面 *",-1)),t(O,{ref:"idCardFrontUploadRef",action:Y,headers:I.value,data:{type:"id_card_front"},"file-list":R.value,"on-success":(r,w)=>M(r,w,"idCardFront"),"on-error":z,"before-upload":K,"on-remove":r=>A(r,"idCardFront"),"list-type":"picture-card",accept:"image/*,.pdf",limit:1},{default:l(()=>[t(T,null,{default:l(()=>[t(D(L))]),_:1})]),_:1},8,["headers","file-list","on-success","on-remove"])]),s("div",pt,[e[11]||(e[11]=s("h3",{class:"upload-title"},"身份证背面 *",-1)),t(O,{ref:"idCardBackUploadRef",action:Y,headers:I.value,data:{type:"id_card_back"},"file-list":ee.value,"on-success":(r,w)=>M(r,w,"idCardBack"),"on-error":z,"before-upload":K,"on-remove":r=>A(r,"idCardBack"),"list-type":"picture-card",accept:"image/*,.pdf",limit:1},{default:l(()=>[t(T,null,{default:l(()=>[t(D(L))]),_:1})]),_:1},8,["headers","file-list","on-success","on-remove"])]),s("div",mt,[e[12]||(e[12]=s("h3",{class:"upload-title"},"手持证件照 *",-1)),e[13]||(e[13]=s("p",{class:"text-sm text-gray-500 mb-3"}," 请手持身份证与您的脸部一起拍照，确保人脸和证件信息都清晰可见 ",-1)),t(O,{ref:"selfieUploadRef",action:Y,headers:I.value,data:{type:"selfie"},"file-list":te.value,"on-success":(r,w)=>M(r,w,"selfie"),"on-error":z,"before-upload":K,"on-remove":r=>A(r,"selfie"),"list-type":"picture-card",accept:"image/*",limit:1},{default:l(()=>[t(T,null,{default:l(()=>[t(D(L))]),_:1})]),_:1},8,["headers","file-list","on-success","on-remove"])]),s("div",ct,[e[14]||(e[14]=s("h3",{class:"upload-title"},"地址证明（可选）",-1)),e[15]||(e[15]=s("p",{class:"text-sm text-gray-500 mb-3"}," 可上传水电费账单、银行对账单等包含您姓名和地址的文件 ",-1)),t(O,{ref:"addressProofUploadRef",action:Y,headers:I.value,data:{type:"proof_of_address"},"file-list":le.value,"on-success":(r,w)=>M(r,w,"addressProof"),"on-error":z,"before-upload":K,"on-remove":r=>A(r,"addressProof"),"list-type":"picture-card",accept:"image/*,.pdf",limit:1},{default:l(()=>[t(T,null,{default:l(()=>[t(D(L))]),_:1})]),_:1},8,["headers","file-list","on-success","on-remove"])])])])):U("",!0),p.value===2?(n(),k("div",gt,[e[20]||(e[20]=s("h2",{class:"step-title"},"人脸识别验证",-1)),s("div",vt,[s("div",yt,[y.value?(n(),k("div",kt,[s("div",xt,[t(T,{size:80,class:"text-green-500"},{default:l(()=>[t(D(Ae))]),_:1})]),e[19]||(e[19]=s("p",{class:"text-lg text-green-600"}," 人脸识别验证成功！ ",-1))])):(n(),k("div",_t,[s("div",bt,[t(T,{size:80,class:"text-blue-500"},{default:l(()=>[t(D(Me))]),_:1})]),e[18]||(e[18]=s("p",{class:"text-lg text-gray-700 dark:text-gray-300"}," 请点击下方按钮开始人脸识别验证 ",-1)),t(S,{type:"primary",size:"large",onClick:oe,loading:P.value},{default:l(()=>[...e[17]||(e[17]=[i(" 开始人脸识别 ",-1)])]),_:1},8,["loading"])]))])])])):U("",!0),p.value===3?(n(),k("div",Ct,[e[42]||(e[42]=s("h2",{class:"step-title"},"确认提交",-1)),s("div",Vt,[t(j,null,{header:l(()=>[...e[21]||(e[21]=[s("span",{class:"font-medium"},"请确认您的信息",-1)])]),default:l(()=>[t(be,{column:2,border:""},{default:l(()=>[t(V,{label:"姓名"},{default:l(()=>[i(E(o.fullName),1)]),_:1}),t(V,{label:"性别"},{default:l(()=>[i(E(ue(o.gender)),1)]),_:1}),t(V,{label:"出生日期"},{default:l(()=>[i(E(o.dateOfBirth),1)]),_:1}),t(V,{label:"国籍"},{default:l(()=>[i(E(fe(o.nationality)),1)]),_:1}),t(V,{label:"证件类型"},{default:l(()=>[i(E(pe(o.idType)),1)]),_:1}),t(V,{label:"证件号码"},{default:l(()=>[i(E(me(o.idNumber)),1)]),_:1}),t(V,{label:"地址",span:"2"},{default:l(()=>[i(E(o.address),1)]),_:1})]),_:1})]),_:1}),t(j,null,{header:l(()=>[...e[22]||(e[22]=[s("span",{class:"font-medium"},"已上传文件",-1)])]),default:l(()=>[s("div",wt,[s("div",Et,[e[25]||(e[25]=s("span",null,"身份证正面",-1)),o.idCardFront?(n(),m(b,{key:0,type:"success"},{default:l(()=>[...e[23]||(e[23]=[i("已上传",-1)])]),_:1})):(n(),m(b,{key:1,type:"danger"},{default:l(()=>[...e[24]||(e[24]=[i("未上传",-1)])]),_:1}))]),s("div",Bt,[e[28]||(e[28]=s("span",null,"身份证背面",-1)),o.idCardBack?(n(),m(b,{key:0,type:"success"},{default:l(()=>[...e[26]||(e[26]=[i("已上传",-1)])]),_:1})):(n(),m(b,{key:1,type:"danger"},{default:l(()=>[...e[27]||(e[27]=[i("未上传",-1)])]),_:1}))]),s("div",Tt,[e[31]||(e[31]=s("span",null,"手持证件照",-1)),o.selfie?(n(),m(b,{key:0,type:"success"},{default:l(()=>[...e[29]||(e[29]=[i("已上传",-1)])]),_:1})):(n(),m(b,{key:1,type:"danger"},{default:l(()=>[...e[30]||(e[30]=[i("未上传",-1)])]),_:1}))]),s("div",Dt,[e[34]||(e[34]=s("span",null,"地址证明",-1)),o.addressProof?(n(),m(b,{key:0,type:"success"},{default:l(()=>[...e[32]||(e[32]=[i("已上传",-1)])]),_:1})):(n(),m(b,{key:1,type:"info"},{default:l(()=>[...e[33]||(e[33]=[i("可选",-1)])]),_:1}))]),s("div",Ft,[e[37]||(e[37]=s("span",null,"人脸识别",-1)),y.value?(n(),m(b,{key:0,type:"success"},{default:l(()=>[...e[35]||(e[35]=[i("已完成",-1)])]),_:1})):(n(),m(b,{key:1,type:"danger"},{default:l(()=>[...e[36]||(e[36]=[i("未完成",-1)])]),_:1}))])])]),_:1}),t(j,null,{default:l(()=>[t(ke,{modelValue:v.value,"onUpdate:modelValue":e[7]||(e[7]=r=>v.value=r),size:"large"},{default:l(()=>[e[40]||(e[40]=i(" 我已阅读并同意 ",-1)),t(Q,{type:"primary",onClick:ce},{default:l(()=>[...e[38]||(e[38]=[i("《服务条款》",-1)])]),_:1}),e[41]||(e[41]=i(" 和 ",-1)),t(Q,{type:"primary",onClick:ge},{default:l(()=>[...e[39]||(e[39]=[i("《隐私政策》",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})])])):U("",!0)]),_:1},8,["model"]),s("div",Pt,[p.value>0?(n(),m(S,{key:0,onClick:ie,size:"large"},{default:l(()=>[...e[43]||(e[43]=[i(" 上一步 ",-1)])]),_:1})):U("",!0),e[47]||(e[47]=s("div",null,null,-1)),s("div",Rt,[t(S,{onClick:ne,loading:F.value},{default:l(()=>[...e[44]||(e[44]=[i(" 保存草稿 ",-1)])]),_:1},8,["loading"]),p.value<3?(n(),m(S,{key:0,type:"primary",onClick:re,size:"large"},{default:l(()=>[...e[45]||(e[45]=[i(" 下一步 ",-1)])]),_:1})):(n(),m(S,{key:1,type:"primary",onClick:de,size:"large",loading:B.value,disabled:!J.value},{default:l(()=>[...e[46]||(e[46]=[i(" 提交审核 ",-1)])]),_:1},8,["loading","disabled"]))])])]),_:1})])])}}}),zt=st(St,[["__scopeId","data-v-218d93e4"]]);export{zt as default};
