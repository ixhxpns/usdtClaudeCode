var E=($,I,m)=>new Promise((k,d)=>{var C=f=>{try{U(m.next(f))}catch(t){d(t)}},M=f=>{try{U(m.throw(f))}catch(t){d(t)}},U=f=>f.done?k(f.value):Promise.resolve(f.value).then(C,M);U((m=m.apply($,I)).next())});import{T as oe,G as ne,h as ue,u as de,U as re,c as ie,V as pe,W as _e,f as ce,g as fe,S as ve,X as me,d as ge,Y as ye,Z as be,_ as Ve,j as Ee,$ as he,x as we,O as ke,C as Ce,a0 as Me,m as Ue,t as De,D as Be,l as xe,E as B,a1 as Ie}from"./element-plus-BimyLctg.js";import{d as Ne,aQ as Te,r as y,c as T,o as Ae,f as P,j as h,Q as e,H as a,k as s,K as x,G as S,u as c,M as p,O as w}from"./vue-vendor-D1tpuXMX.js";import{u as Pe,g as Se,_ as $e}from"./index-CNq4hTTw.js";import{aN as Ke}from"./vendor-CPjYCZhe.js";const Re={class:"profile-info-view"},Oe={class:"card-header"},Ye={class:"profile-content"},ze={class:"avatar-section"},Ge={key:0,class:"avatar-overlay"},Le={class:"profile-form"},je={class:"input-with-status"},Fe={class:"input-with-status"},He={key:0,class:"form-actions"},qe={class:"stat-item"},Qe={class:"stat-icon"},We={class:"stat-content"},Je={class:"stat-value"},Xe={class:"stat-item"},Ze={class:"stat-icon"},ea={class:"stat-content"},aa={class:"stat-value"},la={class:"stat-item"},ta={class:"stat-icon"},sa={class:"stat-content"},oa={class:"stat-value"},na={class:"quick-actions"},ua=Ne({__name:"ProfileInfoView",setup($){const I=Te(),m=Pe(),k=y(),d=y(!1),C=y(!1),M=y(!1),U=y("0.00"),f=y(0),t=y({avatar:"",username:"",email:"",realName:"",phone:"",birthDate:"",gender:"MALE",address:"",occupation:"",annualIncome:""}),n=T(()=>m.user),R=T(()=>"undefined/users/upload-avatar"),O=T(()=>({Authorization:`Bearer ${Se()}`})),Y=T(()=>{var u;return(u=n.value)!=null&&u.created_at?Ke(n.value.created_at).format("YYYY-MM-DD"):"--"}),z={realName:[{required:!0,message:"請輸入真實姓名",trigger:"blur"},{min:2,max:50,message:"姓名長度應在2-50個字符之間",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"請輸入有效的手機號碼",trigger:"blur"}]},G=u=>u.getTime()>Date.now()||u.getTime()<new Date("1900-01-01").getTime(),L=u=>u.type!=="image/jpeg"&&u.type!=="image/png"?(B.error("頭像只能是 JPG 或 PNG 格式!"),!1):u.size/1024/1024>2?(B.error("頭像大小不能超過 2MB!"),!1):!0,j=u=>{t.value.avatar=u.url,B.success("頭像上傳成功")},F=()=>E(this,null,function*(){if(k.value)try{if(!(yield k.value.validate()))return;C.value=!0,yield m.refreshUserInfo(),d.value=!1,B.success("個人資料更新成功")}catch(u){B.error(u.message||"保存失敗")}finally{C.value=!1}}),H=()=>E(this,null,function*(){try{M.value=!0,yield m.sendEmailVerification()}catch(u){}finally{M.value=!1}}),q=()=>E(this,null,function*(){try{yield Ie.prompt("請輸入手機驗證碼","手機驗證",{confirmButtonText:"驗證",cancelButtonText:"取消",inputPattern:/^\d{6}$/,inputErrorMessage:"請輸入6位數字驗證碼"})}catch(u){console.error("手機驗證失敗:",u)}}),Q=()=>{I.push("/kyc/status")},W=()=>{I.push("/profile/security")},J=()=>E(this,null,function*(){n.value&&(t.value={avatar:n.value.avatar||"",username:n.value.username||"",email:n.value.email||"",realName:n.value.real_name||"",phone:n.value.phone||"",birthDate:n.value.birth_date||"",gender:n.value.gender||"MALE",address:n.value.address||"",occupation:n.value.occupation||"",annualIncome:n.value.annual_income||""})}),X=()=>E(this,null,function*(){});return Ae(()=>{J(),X()}),(u,l)=>{const _=ue,g=Ee,Z=ne,ee=oe,b=fe,v=ce,r=_e,K=ve,V=pe,ae=me,A=ye,le=ge,N=Ve,te=be,se=ie,D=we;return h(),P("div",Re,[e(D,{class:"profile-card",shadow:"never"},{header:a(()=>[s("div",Oe,[l[11]||(l[11]=s("h3",null,"個人信息",-1)),e(g,{type:"primary",onClick:l[0]||(l[0]=o=>d.value=!d.value)},{default:a(()=>[e(_,null,{default:a(()=>[e(c(he))]),_:1}),p(" "+w(d.value?"取消編輯":"編輯資料"),1)]),_:1})])]),default:a(()=>[s("div",Ye,[s("div",ze,[e(ee,{class:"avatar-uploader",action:R.value,headers:O.value,"show-file-list":!1,"before-upload":L,"on-success":j,disabled:!d.value},{default:a(()=>[e(Z,{size:120,src:t.value.avatar,class:"avatar"},{default:a(()=>[t.value.avatar?x("",!0):(h(),S(_,{key:0},{default:a(()=>[e(c(de))]),_:1}))]),_:1},8,["src"]),d.value?(h(),P("div",Ge,[e(_,null,{default:a(()=>[e(c(re))]),_:1}),l[12]||(l[12]=s("span",null,"更換頭像",-1))])):x("",!0)]),_:1},8,["action","headers","disabled"])]),s("div",Le,[e(se,{ref_key:"profileFormRef",ref:k,model:t.value,rules:z,"label-width":"100px",disabled:!d.value},{default:a(()=>[e(V,{gutter:24},{default:a(()=>[e(r,{span:12},{default:a(()=>[e(v,{label:"用戶名",prop:"username"},{default:a(()=>[e(b,{modelValue:t.value.username,"onUpdate:modelValue":l[1]||(l[1]=o=>t.value.username=o),disabled:!0,placeholder:"用戶名不可修改"},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:12},{default:a(()=>[e(v,{label:"電子郵箱",prop:"email"},{default:a(()=>{var o;return[s("div",je,[e(b,{modelValue:t.value.email,"onUpdate:modelValue":l[2]||(l[2]=i=>t.value.email=i),disabled:!0,placeholder:"電子郵箱"},null,8,["modelValue"]),e(K,{type:(o=n.value)!=null&&o.email_verified?"success":"warning",size:"small",class:"status-tag"},{default:a(()=>{var i;return[p(w((i=n.value)!=null&&i.email_verified?"已驗證":"未驗證"),1)]}),_:1},8,["type"])])]}),_:1})]),_:1})]),_:1}),e(V,{gutter:24},{default:a(()=>[e(r,{span:12},{default:a(()=>[e(v,{label:"真實姓名",prop:"realName"},{default:a(()=>[e(b,{modelValue:t.value.realName,"onUpdate:modelValue":l[3]||(l[3]=o=>t.value.realName=o),placeholder:"請輸入真實姓名"},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:12},{default:a(()=>[e(v,{label:"手機號碼",prop:"phone"},{default:a(()=>{var o;return[s("div",Fe,[e(b,{modelValue:t.value.phone,"onUpdate:modelValue":l[4]||(l[4]=i=>t.value.phone=i),placeholder:"請輸入手機號碼"},null,8,["modelValue"]),e(K,{type:(o=n.value)!=null&&o.phone_verified?"success":"warning",size:"small",class:"status-tag"},{default:a(()=>{var i;return[p(w((i=n.value)!=null&&i.phone_verified?"已驗證":"未驗證"),1)]}),_:1},8,["type"])])]}),_:1})]),_:1})]),_:1}),e(V,{gutter:24},{default:a(()=>[e(r,{span:12},{default:a(()=>[e(v,{label:"出生日期",prop:"birthDate"},{default:a(()=>[e(ae,{modelValue:t.value.birthDate,"onUpdate:modelValue":l[5]||(l[5]=o=>t.value.birthDate=o),type:"date",placeholder:"選擇出生日期",style:{width:"100%"},"disabled-date":G},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:12},{default:a(()=>[e(v,{label:"性別",prop:"gender"},{default:a(()=>[e(le,{modelValue:t.value.gender,"onUpdate:modelValue":l[6]||(l[6]=o=>t.value.gender=o)},{default:a(()=>[e(A,{label:"MALE"},{default:a(()=>[...l[13]||(l[13]=[p("男",-1)])]),_:1}),e(A,{label:"FEMALE"},{default:a(()=>[...l[14]||(l[14]=[p("女",-1)])]),_:1}),e(A,{label:"OTHER"},{default:a(()=>[...l[15]||(l[15]=[p("其他",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(V,{gutter:24},{default:a(()=>[e(r,{span:24},{default:a(()=>[e(v,{label:"地址",prop:"address"},{default:a(()=>[e(b,{modelValue:t.value.address,"onUpdate:modelValue":l[7]||(l[7]=o=>t.value.address=o),type:"textarea",rows:3,placeholder:"請輸入詳細地址"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(V,{gutter:24},{default:a(()=>[e(r,{span:12},{default:a(()=>[e(v,{label:"職業",prop:"occupation"},{default:a(()=>[e(b,{modelValue:t.value.occupation,"onUpdate:modelValue":l[8]||(l[8]=o=>t.value.occupation=o),placeholder:"請輸入職業"},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:12},{default:a(()=>[e(v,{label:"年收入",prop:"annualIncome"},{default:a(()=>[e(te,{modelValue:t.value.annualIncome,"onUpdate:modelValue":l[9]||(l[9]=o=>t.value.annualIncome=o),placeholder:"請選擇年收入範圍",style:{width:"100%"}},{default:a(()=>[e(N,{label:"10萬以下",value:"BELOW_100K"}),e(N,{label:"10-50萬",value:"100K_500K"}),e(N,{label:"50-100萬",value:"500K_1M"}),e(N,{label:"100萬以上",value:"ABOVE_1M"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),d.value?(h(),P("div",He,[e(g,{onClick:l[10]||(l[10]=o=>d.value=!1)},{default:a(()=>[...l[16]||(l[16]=[p("取消",-1)])]),_:1}),e(g,{type:"primary",onClick:F,loading:C.value},{default:a(()=>[...l[17]||(l[17]=[p(" 保存更改 ",-1)])]),_:1},8,["loading"])])):x("",!0)]),_:1},8,["model","disabled"])])])]),_:1}),e(V,{gutter:24,class:"stats-section"},{default:a(()=>[e(r,{span:8},{default:a(()=>[e(D,{class:"stat-card"},{default:a(()=>[s("div",qe,[s("div",Qe,[e(_,null,{default:a(()=>[e(c(ke))]),_:1})]),s("div",We,[l[18]||(l[18]=s("div",{class:"stat-label"},"賬戶餘額",-1)),s("div",Je,"$"+w(U.value),1)])])]),_:1})]),_:1}),e(r,{span:8},{default:a(()=>[e(D,{class:"stat-card"},{default:a(()=>[s("div",Xe,[s("div",Ze,[e(_,null,{default:a(()=>[e(c(Ce))]),_:1})]),s("div",ea,[l[19]||(l[19]=s("div",{class:"stat-label"},"交易次數",-1)),s("div",aa,w(f.value),1)])])]),_:1})]),_:1}),e(r,{span:8},{default:a(()=>[e(D,{class:"stat-card"},{default:a(()=>[s("div",la,[s("div",ta,[e(_,null,{default:a(()=>[e(c(Me))]),_:1})]),s("div",sa,[l[20]||(l[20]=s("div",{class:"stat-label"},"註冊時間",-1)),s("div",oa,w(Y.value),1)])])]),_:1})]),_:1})]),_:1}),e(D,{class:"actions-card",shadow:"never"},{header:a(()=>[...l[21]||(l[21]=[s("h3",null,"快速操作",-1)])]),default:a(()=>{var o,i;return[s("div",na,[(o=n.value)!=null&&o.email_verified?x("",!0):(h(),S(g,{key:0,type:"warning",onClick:H,loading:M.value},{default:a(()=>[e(_,null,{default:a(()=>[e(c(Ue))]),_:1}),l[22]||(l[22]=p(" 驗證郵箱 ",-1))]),_:1},8,["loading"])),(i=n.value)!=null&&i.phone_verified?x("",!0):(h(),S(g,{key:1,type:"warning",onClick:q},{default:a(()=>[e(_,null,{default:a(()=>[e(c(De))]),_:1}),l[23]||(l[23]=p(" 驗證手機 ",-1))]),_:1})),e(g,{type:"primary",onClick:Q},{default:a(()=>[e(_,null,{default:a(()=>[e(c(Be))]),_:1}),l[24]||(l[24]=p(" 完成KYC認證 ",-1))]),_:1}),e(g,{onClick:W},{default:a(()=>[e(_,null,{default:a(()=>[e(c(xe))]),_:1}),l[25]||(l[25]=p(" 安全設置 ",-1))]),_:1})])]}),_:1})])}}}),ca=$e(ua,[["__scopeId","data-v-6b49a8c1"]]);export{ca as default};
