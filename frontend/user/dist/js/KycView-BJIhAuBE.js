var g=(c,t,u)=>new Promise((s,v)=>{var p=m=>{try{d(u.next(m))}catch(_){v(_)}},l=m=>{try{d(u.throw(m))}catch(_){v(_)}},d=m=>m.done?s(m.value):Promise.resolve(m.value).then(p,l);d((u=u.apply(c,t)).next())});import{f as o,j as a,k as e,K as f,J as k,O as r,Z as ee,P as w,aj as N,I as b,aA as h,aT as te,Y as T,r as S,_ as I,c as F,o as se}from"./vue-vendor-D1tpuXMX.js";import{_ as le,b as C}from"./index-CNq4hTTw.js";import"./vendor-CPjYCZhe.js";import"./element-plus-BimyLctg.js";const ne={name:"KycView",setup(){const c=S("NOT_STARTED"),t=I({}),u=S(!1),s=S("basic"),v=S(!1),p=S(!1),l=I({realName:"",gender:"",birthDate:"",idNumber:"",phone:"",address:""}),d=I({idFront:null,idBack:null,selfie:null}),m=F(()=>{const n=E.filter(i=>R(i.key)==="completed").length;return Math.round(n/E.length*100)}),_=F(()=>["PENDING","APPROVED"].includes(c.value)),B=F(()=>l.realName&&l.gender&&l.birthDate&&l.idNumber&&l.phone&&l.address&&!v.value),A=F(()=>d.idFront&&d.idBack&&d.selfie&&!p.value),E=[{key:"basic",title:"基本信息",description:"填寫真實姓名、身份證號等基本信息",requirements:["身份證","手機號碼"]},{key:"documents",title:"身份證件",description:"上傳身份證正反面及手持身份證自拍照",requirements:["身份證正面","身份證背面","手持身份證自拍"]},{key:"review",title:"人工審核",description:"我們會在1-3個工作日內完成審核",requirements:null}],D=[{level:1,name:"基礎認證",description:"完成身份基本信息驗證",dailyWithdraw:1e4,monthlyWithdraw:1e5,requirements:["身份證正反面","手持身份證自拍"]},{level:2,name:"進階認證",description:"銀行賬戶和地址驗證",dailyWithdraw:1e5,monthlyWithdraw:1e6,requirements:["基礎認證","銀行賬戶信息","地址證明"]},{level:3,name:"專業認證",description:"收入來源和資金來源驗證",dailyWithdraw:5e5,monthlyWithdraw:5e6,requirements:["進階認證","收入證明","資金來源說明"]}],U=n=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0}).format(n||0),V=()=>({NOT_STARTED:"icon-info",PENDING:"icon-clock",UNDER_REVIEW:"icon-review",APPROVED:"icon-check-circle",REJECTED:"icon-x-circle",REQUIRES_SUPPLEMENT:"icon-alert"})[c.value]||"icon-info",W=()=>({NOT_STARTED:"開始身份驗證",PENDING:"等待審核",UNDER_REVIEW:"審核中",APPROVED:"驗證通過",REJECTED:"驗證失敗",REQUIRES_SUPPLEMENT:"需要補充材料"})[c.value]||"身份驗證",q=()=>({NOT_STARTED:"完成身份驗證，提升交易額度",PENDING:"您的資料已提交，請等待審核",UNDER_REVIEW:"我們正在審核您的資料，請耐心等待",APPROVED:"您的身份已成功驗證，可以正常交易",REJECTED:"您的驗證材料未通過審核，請重新提交",REQUIRES_SUPPLEMENT:"請根據要求補充相關材料"})[c.value]||"",M=()=>{const n=t.level||1,i=D.find(y=>y.level===n);return i?`等級 ${n} - ${i.name}`:"等級 1"},O=()=>{const n=t.level||1;return D.find(i=>i.level===n)||D[0]},R=n=>{switch(n){case"basic":return t.basicCompleted?"completed":c.value==="NOT_STARTED"?"active":"pending";case"documents":return t.documentsCompleted?"completed":t.basicCompleted?"active":"pending";case"review":return c.value==="APPROVED"?"completed":["PENDING","UNDER_REVIEW"].includes(c.value)?"active":"pending";default:return"pending"}},x=n=>R(n)==="active"||n==="basic"&&c.value==="REQUIRES_SUPPLEMENT",G=n=>{const i=R(n);return i==="completed"?"已完成":i==="active"?n==="basic"?"填寫信息":n==="documents"?"上傳文件":"審核中":"等待中"},J=()=>{const n=E.find(i=>i.key===s.value);return n?n.title:""},j=n=>{(n==="basic"||n==="documents")&&(s.value=n,u.value=!0,Z())},z=n=>{const i=document.querySelector(`input[ref="${n}Input"]`);i&&i.click()},K=(n,i)=>{const y=i.target.files[0];if(!y||!Y(y))return;const L=new FileReader;L.onload=$=>{d[n]={file:y,preview:$.target.result}},L.readAsDataURL(y)},Q=n=>{d[n]=null;const i=document.querySelector(`input[ref="${n}Input"]`);i&&(i.value="")},Y=n=>n.type.startsWith("image/")?n.size>5*1024*1024?(alert("文件大小不能超過5MB"),!1):!0:(alert("請選擇圖片文件"),!1),P=()=>g(this,null,function*(){try{const n=yield C.get("/kyc/status");if(n.data.success){const i=n.data.data;c.value=i.status||"NOT_STARTED",Object.assign(t,i)}}catch(n){console.error("獲取KYC狀態失敗:",n)}}),Z=()=>g(this,null,function*(){t.basicCompleted&&Object.assign(l,t.basicInfo||{})}),H=()=>g(this,null,function*(){if(B.value){v.value=!0;try{const n=yield C.post("/kyc/basic",l);n.data.success?(t.basicCompleted=!0,u.value=!1,P(),alert("基本信息提交成功")):alert("提交失敗: "+n.data.message)}catch(n){console.error("提交基本信息失敗:",n),alert("提交失敗，請稍後重試")}finally{v.value=!1}}}),X=()=>g(this,null,function*(){if(A.value){p.value=!0;try{const n=new FormData;n.append("frontImage",d.idFront.file),n.append("backImage",d.idBack.file),n.append("selfieImage",d.selfie.file);const i=yield C.post("/kyc/upload-id",n,{headers:{"Content-Type":"multipart/form-data"}});i.data.success?(t.documentsCompleted=!0,u.value=!1,P(),alert("文件上傳成功，請等待審核")):alert("上傳失敗: "+i.data.message)}catch(n){console.error("上傳文件失敗:",n),alert("上傳失敗，請稍後重試")}finally{p.value=!1}}});return se(()=>{P()}),{kycStatus:c,kycData:t,showKycForm:u,currentStep:s,submitting:v,uploading:p,basicForm:l,documents:d,progressPercent:m,isReadonly:_,canSubmitBasic:B,canSubmitDocuments:A,kycSteps:E,kycLevels:D,formatPrice:U,getStatusIcon:V,getStatusTitle:W,getStatusDescription:q,getLevelText:M,getLevelLimits:O,getStepStatus:R,canProcessStep:x,getStepActionText:G,getCurrentStepTitle:J,handleStepAction:j,triggerFileInput:z,handleFileSelect:K,removeDocument:Q,submitBasicInfo:H,submitDocuments:X}}},ie={class:"kyc-view"},oe={class:"status-section"},ae={class:"status-header"},re={class:"status-icon"},de={class:"status-info"},ce={key:0,class:"kyc-level"},ue={class:"level-badge"},me={class:"level-benefits"},ve={class:"benefit-item"},pe={class:"benefit-item"},fe={class:"steps-section"},ye={class:"steps-header"},be={class:"progress-bar"},_e={class:"steps-list"},ge={class:"step-number"},ke={key:0},he={key:1},Se={class:"step-content"},Ee={key:0,class:"step-requirements"},De={class:"requirements-text"},Re={class:"step-action"},Fe=["onClick"],Pe={key:0,class:"form-section"},we={class:"form-card"},Ne={class:"form-header"},Te={key:0,class:"basic-form"},Ie={class:"form-grid"},Ce={class:"form-group"},Be=["readonly"],Ae={class:"form-group"},Le=["disabled"],Ue={class:"form-group"},Ve=["readonly"],We={class:"form-group"},qe=["readonly"],Me={class:"form-group"},Oe=["readonly"],xe={class:"form-group full-width"},Ge=["readonly"],Je={key:0,class:"form-actions"},je=["disabled"],ze={key:1,class:"documents-form"},Ke={class:"upload-grid"},Qe={class:"upload-item"},Ye={key:0,class:"upload-placeholder"},Ze={key:1,class:"upload-preview"},He=["src"],Xe={class:"upload-overlay"},$e={class:"upload-item"},et={key:0,class:"upload-placeholder"},tt={key:1,class:"upload-preview"},st=["src"],lt={class:"upload-overlay"},nt={class:"upload-item full-width"},it={key:0,class:"upload-placeholder"},ot={key:1,class:"upload-preview"},at=["src"],rt={class:"upload-overlay"},dt={class:"form-actions"},ct=["disabled"],ut={class:"levels-section"},mt={class:"levels-grid"},vt={class:"level-header"},pt={class:"level-number"},ft={class:"level-description"},yt={class:"level-benefits"},bt={class:"benefit"},_t={class:"value"},gt={class:"benefit"},kt={class:"value"},ht={class:"level-requirements"};function St(c,t,u,s,v,p){return a(),o("div",ie,[e("div",oe,[e("div",{class:k(["status-card",s.kycStatus.toLowerCase()])},[e("div",ae,[e("div",re,[e("i",{class:k(s.getStatusIcon())},null,2)]),e("div",de,[e("h2",null,r(s.getStatusTitle()),1),e("p",null,r(s.getStatusDescription()),1)])]),s.kycData.level?(a(),o("div",ce,[e("span",ue,r(s.getLevelText()),1),e("div",me,[e("div",ve,[t[17]||(t[17]=e("span",null,"日提現額度",-1)),e("span",null,r(s.formatPrice(s.getLevelLimits().dailyWithdraw)),1)]),e("div",pe,[t[18]||(t[18]=e("span",null,"月提現額度",-1)),e("span",null,r(s.formatPrice(s.getLevelLimits().monthlyWithdraw)),1)])])])):f("",!0)],2)]),e("div",fe,[e("div",ye,[t[19]||(t[19]=e("h3",null,"身份驗證流程",-1)),e("div",be,[e("div",{class:"progress-fill",style:ee({width:s.progressPercent+"%"})},null,4)])]),e("div",_e,[(a(!0),o(w,null,N(s.kycSteps,(l,d)=>(a(),o("div",{key:l.key,class:k(["step-item",s.getStepStatus(l.key)])},[e("div",ge,[s.getStepStatus(l.key)==="completed"?(a(),o("span",ke,"✓")):(a(),o("span",he,r(d+1),1))]),e("div",Se,[e("h4",null,r(l.title),1),e("p",null,r(l.description),1),l.requirements?(a(),o("div",Ee,[t[20]||(t[20]=e("span",{class:"requirements-label"},"所需材料：",-1)),e("span",De,r(l.requirements.join("、")),1)])):f("",!0)]),e("div",Re,[s.canProcessStep(l.key)?(a(),o("button",{key:0,class:k(["action-btn",s.getStepStatus(l.key)]),onClick:m=>s.handleStepAction(l.key)},r(s.getStepActionText(l.key)),11,Fe)):f("",!0)])],2))),128))])]),s.showKycForm?(a(),o("div",Pe,[e("div",we,[e("div",Ne,[e("h3",null,r(s.getCurrentStepTitle()),1),t[21]||(t[21]=e("p",null,"請準確填寫以下信息，確保與身份證件一致",-1))]),s.currentStep==="basic"?(a(),o("div",Te,[e("div",Ie,[e("div",Ce,[t[22]||(t[22]=e("label",null,"真實姓名 *",-1)),b(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>s.basicForm.realName=l),type:"text",placeholder:"請輸入身份證上的真實姓名",readonly:s.isReadonly},null,8,Be),[[h,s.basicForm.realName]])]),e("div",Ae,[t[24]||(t[24]=e("label",null,"性別 *",-1)),b(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>s.basicForm.gender=l),disabled:s.isReadonly},[...t[23]||(t[23]=[e("option",{value:""},"請選擇性別",-1),e("option",{value:"MALE"},"男",-1),e("option",{value:"FEMALE"},"女",-1)])],8,Le),[[te,s.basicForm.gender]])]),e("div",Ue,[t[25]||(t[25]=e("label",null,"出生日期 *",-1)),b(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>s.basicForm.birthDate=l),type:"date",readonly:s.isReadonly},null,8,Ve),[[h,s.basicForm.birthDate]])]),e("div",We,[t[26]||(t[26]=e("label",null,"身份證號 *",-1)),b(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>s.basicForm.idNumber=l),type:"text",placeholder:"請輸入身份證號碼",readonly:s.isReadonly},null,8,qe),[[h,s.basicForm.idNumber]])]),e("div",Me,[t[27]||(t[27]=e("label",null,"聯絡電話 *",-1)),b(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>s.basicForm.phone=l),type:"tel",placeholder:"請輸入手機號碼",readonly:s.isReadonly},null,8,Oe),[[h,s.basicForm.phone]])]),e("div",xe,[t[28]||(t[28]=e("label",null,"居住地址 *",-1)),b(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>s.basicForm.address=l),type:"text",placeholder:"請輸入詳細居住地址",readonly:s.isReadonly},null,8,Ge),[[h,s.basicForm.address]])])]),s.isReadonly?f("",!0):(a(),o("div",Je,[e("button",{class:"submit-btn",onClick:t[6]||(t[6]=(...l)=>s.submitBasicInfo&&s.submitBasicInfo(...l)),disabled:!s.canSubmitBasic},r(s.submitting?"提交中...":"保存並繼續"),9,je)]))])):f("",!0),s.currentStep==="documents"?(a(),o("div",ze,[e("div",Ke,[e("div",Qe,[t[30]||(t[30]=e("label",null,"身份證正面 *",-1)),e("div",{class:"upload-area",onClick:t[8]||(t[8]=l=>s.triggerFileInput("idFront"))},[s.documents.idFront?(a(),o("div",Ze,[e("img",{src:s.documents.idFront.preview,alt:"身份證正面"},null,8,He),e("div",Xe,[e("button",{onClick:t[7]||(t[7]=T(l=>s.removeDocument("idFront"),["stop"]))},"重新上傳")])])):(a(),o("div",Ye,[...t[29]||(t[29]=[e("i",{class:"icon-upload"},null,-1),e("p",null,"點擊上傳身份證正面",-1),e("span",{class:"upload-hint"},"支持 JPG、PNG，大小不超過5MB",-1)])]))]),e("input",{ref:"idFrontInput",type:"file",accept:"image/*",onChange:t[9]||(t[9]=l=>s.handleFileSelect("idFront",l)),hidden:""},null,544)]),e("div",$e,[t[32]||(t[32]=e("label",null,"身份證背面 *",-1)),e("div",{class:"upload-area",onClick:t[11]||(t[11]=l=>s.triggerFileInput("idBack"))},[s.documents.idBack?(a(),o("div",tt,[e("img",{src:s.documents.idBack.preview,alt:"身份證背面"},null,8,st),e("div",lt,[e("button",{onClick:t[10]||(t[10]=T(l=>s.removeDocument("idBack"),["stop"]))},"重新上傳")])])):(a(),o("div",et,[...t[31]||(t[31]=[e("i",{class:"icon-upload"},null,-1),e("p",null,"點擊上傳身份證背面",-1),e("span",{class:"upload-hint"},"支持 JPG、PNG，大小不超過5MB",-1)])]))]),e("input",{ref:"idBackInput",type:"file",accept:"image/*",onChange:t[12]||(t[12]=l=>s.handleFileSelect("idBack",l)),hidden:""},null,544)]),e("div",nt,[t[34]||(t[34]=e("label",null,"手持身份證自拍 *",-1)),e("div",{class:"upload-area",onClick:t[14]||(t[14]=l=>s.triggerFileInput("selfie"))},[s.documents.selfie?(a(),o("div",ot,[e("img",{src:s.documents.selfie.preview,alt:"手持身份證自拍"},null,8,at),e("div",rt,[e("button",{onClick:t[13]||(t[13]=T(l=>s.removeDocument("selfie"),["stop"]))},"重新上傳")])])):(a(),o("div",it,[...t[33]||(t[33]=[e("i",{class:"icon-upload"},null,-1),e("p",null,"點擊上傳手持身份證自拍照",-1),e("span",{class:"upload-hint"},"請清晰拍攝本人手持身份證的照片",-1)])]))]),e("input",{ref:"selfieInput",type:"file",accept:"image/*",onChange:t[15]||(t[15]=l=>s.handleFileSelect("selfie",l)),hidden:""},null,544)])]),t[35]||(t[35]=e("div",{class:"upload-tips"},[e("h4",null,"拍照要求"),e("ul",null,[e("li",null,"照片清晰，光線充足，無反光"),e("li",null,"身份證件完整顯示，四個角不能缺失"),e("li",null,"手持身份證自拍需要清楚顯示人臉和身份證信息"),e("li",null,"文件大小不超過5MB，支持JPG、PNG格式")])],-1)),e("div",dt,[e("button",{class:"submit-btn",onClick:t[16]||(t[16]=(...l)=>s.submitDocuments&&s.submitDocuments(...l)),disabled:!s.canSubmitDocuments},r(s.uploading?"上傳中...":"提交文件"),9,ct)])])):f("",!0)])])):f("",!0),e("div",ut,[t[39]||(t[39]=e("div",{class:"levels-header"},[e("h3",null,"KYC等級說明"),e("p",null,"完成不同等級的身份驗證，可享受相應的服務權益")],-1)),e("div",mt,[(a(!0),o(w,null,N(s.kycLevels,l=>(a(),o("div",{key:l.level,class:k(["level-card",{current:s.kycData.level===l.level}])},[e("div",vt,[e("span",pt,r(l.level),1),e("h4",null,r(l.name),1)]),e("div",ft,[e("p",null,r(l.description),1)]),e("div",yt,[e("div",bt,[t[36]||(t[36]=e("span",{class:"label"},"日提現額度",-1)),e("span",_t,r(s.formatPrice(l.dailyWithdraw)),1)]),e("div",gt,[t[37]||(t[37]=e("span",{class:"label"},"月提現額度",-1)),e("span",kt,r(s.formatPrice(l.monthlyWithdraw)),1)])]),e("div",ht,[t[38]||(t[38]=e("span",{class:"requirements-label"},"認證要求",-1)),e("ul",null,[(a(!0),o(w,null,N(l.requirements,d=>(a(),o("li",{key:d},r(d),1))),128))])])],2))),128))])])])}const wt=le(ne,[["render",St],["__scopeId","data-v-134de6a4"]]);export{wt as default};
