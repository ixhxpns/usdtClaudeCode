var T=(F,U,f)=>new Promise((r,_)=>{var d=m=>{try{g(f.next(m))}catch(k){_(k)}},c=m=>{try{g(f.throw(m))}catch(k){_(k)}},g=m=>m.done?r(m.value):Promise.resolve(m.value).then(d,c);g((f=f.apply(F,U)).next())});import{c as P,d as O,e as Q,f as G,g as H,m as Y,u as W,l as J,s as I,h as X,r as Z,i as ee,j as te,k as se,n as ae,o as z,E as V}from"./element-plus-BimyLctg.js";import{d as le,aQ as oe,aR as re,r as h,_ as ie,c as ne,o as de,an as ue,G as y,j as u,H as o,Q as l,u as s,Y as me,k as t,K as M,f as v,M as p,O as q,ai as A,P as pe,aj as ce,L as ge}from"./vue-vendor-D1tpuXMX.js";import{u as fe,_ as xe}from"./index-CNq4hTTw.js";import{A as _e}from"./AuthLayout-BYquXUgD.js";import{V as be}from"./VerificationCodeInput-C7bNLV10.js";import{v as ye,a as D}from"./validators-CjzGUDfk.js";import"./vendor-CPjYCZhe.js";const ve={class:"text-sm text-gray-600 dark:text-gray-400"},ke={class:"login-type-switcher"},we={class:"flex items-center justify-center space-x-4 mb-6"},Ve={class:"form-label"},he={class:"flex space-x-2"},Ce=["src"],Ee={key:1,class:"h-12 w-24 border rounded bg-gray-100 dark:bg-gray-700 flex items-center justify-center"},Le={class:"form-options flex items-center justify-between"},Ae={key:2,class:"login-attempts-warning"},Ue={key:0},Re={key:1},Te={class:"text-center space-y-4"},ze={class:"social-login-placeholder"},Me={class:"flex justify-center space-x-4"},Fe={class:"security-notice bg-green-50 dark:bg-green-900/20 rounded-lg p-4"},je={class:"flex items-center space-x-2 mb-2"},Ie=5,qe=le({__name:"LoginView",setup(F){const U=oe(),f=re(),r=fe(),_=h(),d=h("email"),c=h(!1),g=h(!1),m=h(""),k=[{name:"Google",icon:z},{name:"Apple",icon:z},{name:"WeChat",icon:z}],a=ie({email:"",username:"",password:"",mfa_code:"",remember_me:!1,captcha:""}),K=ne(()=>({email:[{required:d.value==="email",message:"请输入邮箱地址",trigger:"blur"},{validator:(i,e,x)=>{d.value==="email"&&e&&!D(e)?x(new Error("请输入有效的邮箱地址")):x()},trigger:"blur"}],username:[{required:d.value==="username",message:"请输入用户名",trigger:"blur"},{validator:(i,e,x)=>{d.value==="username"&&e&&!ye(e)?x(new Error("请输入有效的用户名")):x()},trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:1,message:"密码不能为空",trigger:"blur"}],captcha:[{required:c.value,message:"请输入验证码",trigger:"blur"},{len:4,message:"验证码长度为4位",trigger:"blur"}],mfa_code:[{required:g.value,message:"请输入双因子认证码",trigger:"blur"},{len:6,message:"认证码长度为6位",trigger:"blur"}]})),C=()=>T(this,null,function*(){try{m.value=`data:image/svg+xml;base64,${btoa(`
      <svg width="96" height="48" xmlns="http://www.w3.org/2000/svg">
        <rect width="96" height="48" fill="#f0f0f0"/>
        <text x="48" y="30" text-anchor="middle" fill="#666" font-size="16" font-family="monospace">
          ${Math.random().toString(36).substring(2,6).toUpperCase()}
        </text>
      </svg>
    `)}`}catch(i){V.error("获取验证码失败")}}),S=i=>{a.mfa_code=i},b=()=>T(this,null,function*(){if(_.value)try{yield _.value.validate();const i={email:d.value==="email"?a.email:a.username||"",password:a.password,remember_me:a.remember_me};c.value&&a.captcha&&(i.captcha=a.captcha),g.value&&a.mfa_code&&(i.mfa_code=a.mfa_code),yield r.login(i),V.success("登录成功，欢迎回来！");const e=f.query.redirect||"/dashboard";U.push(e)}catch(i){console.error("登录失败:",i),i.code==="CAPTCHA_REQUIRED"?(c.value=!0,C(),V.warning("请完成验证码验证")):i.code==="MFA_REQUIRED"?(g.value=!0,V.info("请输入双因子认证码")):i.code==="ACCOUNT_LOCKED"?V.error("账户已被锁定，请联系客服"):i.code==="TOO_MANY_ATTEMPTS"&&(c.value=!0,C())}});return de(()=>{r.loginAttempts>=3&&(c.value=!0,C());const i=f.query.email;i&&D(i)&&(a.email=i,d.value="email")}),(i,e)=>{const x=ue("router-link"),j=Q,$=O,E=H,w=G,L=X,B=ee,R=te,N=se;return u(),y(_e,{"form-title":"欢迎回来","form-subtitle":"请登录您的账户继续交易",loading:s(r).isLoading,"loading-text":"登录中，请稍候..."},{navigation:o(()=>[t("p",ve,[e[9]||(e[9]=p(" 还没有账户？ ",-1)),l(x,{to:"/register",class:"font-medium text-blue-600 hover:text-blue-500 dark:text-blue-400 transition-colors"},{default:o(()=>[...e[8]||(e[8]=[p(" 立即注册 ",-1)])]),_:1})])]),footer:o(()=>[t("div",Te,[t("div",ze,[e[19]||(e[19]=t("div",{class:"flex items-center space-x-4 mb-4"},[t("div",{class:"flex-1 h-px bg-gray-300 dark:bg-gray-600"}),t("span",{class:"text-xs text-gray-500 dark:text-gray-400"},"或使用以下方式登录"),t("div",{class:"flex-1 h-px bg-gray-300 dark:bg-gray-600"})],-1)),t("div",Me,[(u(),v(pe,null,ce(k,n=>l(R,{key:n.name,disabled:!0,size:"large",class:"social-login-btn",title:`${n.name}登录（即将推出）`},{default:o(()=>[l(L,null,{default:o(()=>[(u(),y(ge(n.icon)))]),_:2},1024)]),_:2},1032,["title"])),64))]),e[20]||(e[20]=t("p",{class:"text-xs text-gray-400 mt-2"},"社交登录功能即将推出",-1))]),t("div",Fe,[t("div",je,[l(L,{class:"text-green-600",size:16},{default:o(()=>[l(s(I))]),_:1}),e[21]||(e[21]=t("span",{class:"text-sm font-medium text-green-900 dark:text-green-100"},"登录安全",-1))]),e[22]||(e[22]=t("ul",{class:"text-xs text-green-800 dark:text-green-200 space-y-1"},[t("li",null,"• 系统会记录您的登录设备和IP地址"),t("li",null,"• 异常登录活动将触发安全验证"),t("li",null,"• 建议定期更改密码并启用双因子认证")],-1))]),e[23]||(e[23]=t("div",{class:"text-xs text-gray-500 dark:text-gray-400"},[t("p",null,"© 2024 USDT Trading. 保留所有权利.")],-1))])]),default:o(()=>[l(s(P),{ref_key:"loginFormRef",ref:_,model:a,rules:K.value,class:"space-y-6",onSubmit:me(b,["prevent"])},{default:o(()=>[t("div",ke,[t("div",we,[l($,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=n=>d.value=n),size:"large",class:"login-type-group"},{default:o(()=>[l(j,{label:"email"},{default:o(()=>[...e[10]||(e[10]=[p("邮箱登录",-1)])]),_:1}),l(j,{label:"username"},{default:o(()=>[...e[11]||(e[11]=[p("用户名登录",-1)])]),_:1})]),_:1},8,["modelValue"])])]),l(w,{prop:d.value==="email"?"email":"username",class:"form-group"},{default:o(()=>[t("label",Ve,[p(q(d.value==="email"?"邮箱地址":"用户名")+" ",1),e[12]||(e[12]=t("span",{class:"text-red-500"},"*",-1))]),d.value==="email"?(u(),y(E,{key:0,modelValue:a.email,"onUpdate:modelValue":e[1]||(e[1]=n=>a.email=n),type:"email",size:"large",placeholder:"请输入邮箱地址","prefix-icon":s(Y),disabled:s(r).isLoading,autocomplete:"email",onKeyup:A(b,["enter"])},null,8,["modelValue","prefix-icon","disabled"])):(u(),y(E,{key:1,modelValue:a.username,"onUpdate:modelValue":e[2]||(e[2]=n=>a.username=n),size:"large",placeholder:"请输入用户名","prefix-icon":s(W),disabled:s(r).isLoading,autocomplete:"username",onKeyup:A(b,["enter"])},null,8,["modelValue","prefix-icon","disabled"]))]),_:1},8,["prop"]),l(w,{prop:"password",class:"form-group"},{default:o(()=>[e[13]||(e[13]=t("label",{class:"form-label"},[p(" 密码 "),t("span",{class:"text-red-500"},"*")],-1)),l(E,{modelValue:a.password,"onUpdate:modelValue":e[3]||(e[3]=n=>a.password=n),type:"password",size:"large",placeholder:"请输入密码","prefix-icon":s(J),"show-password":"",disabled:s(r).isLoading,autocomplete:"current-password",onKeyup:A(b,["enter"])},null,8,["modelValue","prefix-icon","disabled"])]),_:1}),c.value?(u(),y(w,{key:0,prop:"captcha",class:"form-group"},{default:o(()=>[e[14]||(e[14]=t("label",{class:"form-label"},[p(" 验证码 "),t("span",{class:"text-red-500"},"*")],-1)),t("div",he,[l(E,{modelValue:a.captcha,"onUpdate:modelValue":e[4]||(e[4]=n=>a.captcha=n),size:"large",placeholder:"请输入验证码","prefix-icon":s(I),disabled:s(r).isLoading,class:"flex-1",onKeyup:A(b,["enter"])},null,8,["modelValue","prefix-icon","disabled"]),t("div",{class:"captcha-image cursor-pointer",onClick:C,title:"点击刷新验证码"},[m.value?(u(),v("img",{key:0,src:m.value,alt:"验证码",class:"h-12 w-24 border rounded object-cover"},null,8,Ce)):(u(),v("div",Ee,[l(L,{class:"text-gray-400"},{default:o(()=>[l(s(Z))]),_:1})]))])]),e[15]||(e[15]=t("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},"点击图片刷新验证码",-1))]),_:1})):M("",!0),g.value?(u(),y(w,{key:1,prop:"mfa_code",class:"form-group"},{default:o(()=>[e[16]||(e[16]=t("label",{class:"form-label"},[p(" 双因子认证码 "),t("span",{class:"text-red-500"},"*")],-1)),l(be,{modelValue:a.mfa_code,"onUpdate:modelValue":e[5]||(e[5]=n=>a.mfa_code=n),length:6,disabled:s(r).isLoading,"show-resend":!1,hint:"请输入您的双因子认证器生成的6位验证码",onComplete:S},null,8,["modelValue","disabled"])]),_:1})):M("",!0),t("div",Le,[l(B,{modelValue:a.remember_me,"onUpdate:modelValue":e[6]||(e[6]=n=>a.remember_me=n),disabled:s(r).isLoading,size:"large"},{default:o(()=>[...e[17]||(e[17]=[t("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"记住我",-1)])]),_:1},8,["modelValue","disabled"]),l(R,{type:"text",onClick:e[7]||(e[7]=n=>i.$router.push("/forgot-password")),class:"text-sm text-blue-600 hover:text-blue-500 dark:text-blue-400"},{default:o(()=>[...e[18]||(e[18]=[p(" 忘记密码？ ",-1)])]),_:1})]),s(r).loginAttempts>0?(u(),v("div",Ae,[l(N,{title:`登录失败 ${s(r).loginAttempts} 次`,description:s(r).isLocked?"账户已锁定，请稍后重试":`还可尝试 ${Ie-s(r).loginAttempts} 次`,type:s(r).isLocked?"error":"warning",closable:!1,"show-icon":""},null,8,["title","description","type"])])):M("",!0),l(w,{class:"form-group"},{default:o(()=>[l(R,{type:"primary",size:"large",class:"w-full login-button",loading:s(r).isLoading,disabled:s(r).isLocked,onClick:b},{loading:o(()=>[l(L,{class:"animate-spin"},{default:o(()=>[l(s(ae))]),_:1})]),default:o(()=>[s(r).isLoading?(u(),v("span",Re,"登录中...")):(u(),v("span",Ue,q(s(r).isLocked?"账户已锁定":"登录账户"),1))]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["loading"])}}}),Qe=xe(qe,[["__scopeId","data-v-4827d0c9"]]);export{Qe as default};
