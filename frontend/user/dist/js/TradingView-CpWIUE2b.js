var v=(y,e,c)=>new Promise((s,u)=>{var m=l=>{try{o(c.next(l))}catch(b){u(b)}},r=l=>{try{o(c.throw(l))}catch(b){u(b)}},o=l=>l.done?s(l.value):Promise.resolve(l.value).then(m,r);o((c=c.apply(y,e)).next())});import{an as Z,f as i,j as d,k as t,J as f,M as P,O as a,K as O,P as S,aj as A,I as T,aA as B,aT as U,Q as $,H as tt,aQ as et,r as p,_,c as D,o as st}from"./vue-vendor-D1tpuXMX.js";import{_ as nt,b as g}from"./index-CNq4hTTw.js";import"./vendor-CPjYCZhe.js";import"./element-plus-BimyLctg.js";const ot={name:"TradingView",setup(){const y=et(),e=p("buy"),c=p(!1),s=p(!1),u=_({buyPrice:0,sellPrice:0,lastUpdate:null}),m=_({amount:"",paymentMethod:""}),r=_({usdtAmount:"",receivingBank:"",receivingAccount:""}),o=_({minBuy:10,maxBuy:1e5,minSell:1,maxSell:1e3,dailyRemaining:5e4}),l=_({twd:0,usdt:0}),b=p([]),F=p(0),x=p(0),L=D(()=>F.value>0?"up":F.value<0?"down":"stable"),k=D(()=>m.amount&&parseFloat(m.amount)>=o.minBuy&&m.paymentMethod&&!c.value),h=D(()=>r.usdtAmount&&parseFloat(r.usdtAmount)>=o.minSell&&parseFloat(r.usdtAmount)<=l.usdt&&r.receivingBank&&r.receivingAccount&&!s.value),M=[{label:"買入",value:"buy"},{label:"賣出",value:"sell"}],V=[{label:"銀行轉帳",value:"bank_transfer"},{label:"超商付款",value:"convenience_store"},{label:"線上支付",value:"online_payment"}],I=[{label:"台灣銀行",value:"bot"},{label:"中國信託",value:"ctbc"},{label:"國泰世華",value:"cathay"},{label:"富邦銀行",value:"fubon"},{label:"玉山銀行",value:"esun"}],W=n=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:2}).format(n||0),N=n=>parseFloat(n||0).toFixed(6),E=n=>n>=1e6?(n/1e6).toFixed(1)+"M":n>=1e3?(n/1e3).toFixed(1)+"K":n.toString(),j=n=>new Date(n).toLocaleString("zh-TW"),R=n=>({PENDING:"待處理",PROCESSING:"處理中",COMPLETED:"已完成",CANCELLED:"已取消",FAILED:"失敗"})[n]||n,z=n=>!n||!u.buyPrice?"0.000000":(parseFloat(n)/u.buyPrice).toFixed(6),G=n=>!n||!u.sellPrice?"0.00":(parseFloat(n)*u.sellPrice).toFixed(2),K=()=>{},Q=()=>{},C=()=>v(this,null,function*(){try{const n=yield g.get("/price/current");n.data.success&&Object.assign(u,n.data.data)}catch(n){console.error("獲取價格失敗:",n)}}),Y=()=>v(this,null,function*(){try{const n=yield g.get("/wallet/balance");n.data.success&&Object.assign(l,n.data.data)}catch(n){console.error("獲取餘額失敗:",n)}}),H=()=>v(this,null,function*(){try{const n=yield g.get("/trading/limits");n.data.success&&Object.assign(o,n.data.data)}catch(n){console.error("獲取交易限額失敗:",n)}}),J=()=>v(this,null,function*(){try{const n=yield g.get("/orders/my?pageSize=5");n.data.success&&(b.value=n.data.data.records)}catch(n){console.error("獲取最近訂單失敗:",n)}}),q=()=>v(this,null,function*(){if(k.value){c.value=!0;try{const n=yield g.post("/trading/buy",{amount:parseFloat(m.amount),paymentMethod:m.paymentMethod});n.data.success?y.push(`/orders/${n.data.data.orderId}`):alert("下單失敗: "+n.data.message)}catch(n){console.error("買入下單失敗:",n),alert("下單失敗，請稍後重試")}finally{c.value=!1}}}),X=()=>v(this,null,function*(){if(h.value){s.value=!0;try{const n=yield g.post("/trading/sell",{usdtAmount:parseFloat(r.usdtAmount),receivingBank:r.receivingBank,receivingAccount:r.receivingAccount});n.data.success?y.push(`/orders/${n.data.data.orderId}`):alert("下單失敗: "+n.data.message)}catch(n){console.error("賣出下單失敗:",n),alert("下單失敗，請稍後重試")}finally{s.value=!1}}});return st(()=>{C(),Y(),H(),J();const n=setInterval(C,3e4);return()=>{clearInterval(n)}}),{activeTab:e,buyOrderLoading:c,sellOrderLoading:s,currentPrice:u,buyForm:m,sellForm:r,tradingLimits:o,userBalance:l,recentOrders:b,priceChange24h:F,volume24h:x,priceStatus:L,canSubmitBuy:k,canSubmitSell:h,tradingTabs:M,paymentMethods:V,supportedBanks:I,formatPrice:W,formatCrypto:N,formatVolume:E,formatTime:j,getStatusText:R,calculateUSDTAmount:z,calculateTWDAmount:G,calculateBuyAmount:K,calculateSellAmount:Q,submitBuyOrder:q,submitSellOrder:X}}},at={class:"trading-view"},rt={class:"price-section"},lt={class:"price-card"},it={class:"price-header"},dt={class:"price-display"},ct={class:"buy-price"},ut={class:"price"},mt={class:"sell-price"},vt={class:"price"},yt={class:"price-info"},bt={class:"info-item"},pt={class:"info-item"},gt={class:"trading-section"},ft={class:"trading-tabs"},Tt=["onClick"],_t={key:0,class:"trade-form buy-form"},St={class:"form-group"},At={class:"input-wrapper"},Ft={class:"conversion-info"},Bt={class:"form-group"},Dt=["value"],kt={class:"trading-limits"},ht={class:"limit-item"},Ct={class:"limit-item"},wt=["disabled"],Pt={key:1,class:"trade-form sell-form"},Ot={class:"form-group"},Ut={class:"input-wrapper"},xt={class:"conversion-info"},Lt={class:"balance-info"},Mt={class:"form-group"},Vt=["value"],It={class:"form-group"},Wt=["disabled"],Nt={class:"recent-orders"},Et={class:"section-header"},jt={key:0,class:"orders-list"},Rt=["onClick"],zt={class:"order-info"},Gt={class:"order-details"},Kt={class:"amount"},Qt={class:"time"},Yt={key:1,class:"no-orders"};function Ht(y,e,c,s,u,m){const r=Z("router-link");return d(),i("div",at,[t("div",rt,[t("div",lt,[t("div",it,[e[10]||(e[10]=t("h2",null,"USDT 實時價格",-1)),t("div",{class:f(["price-status",s.priceStatus])},[e[9]||(e[9]=t("span",{class:"status-dot"},null,-1)),P(" "+a(s.priceStatus==="up"?"上漲":s.priceStatus==="down"?"下跌":"平穩"),1)],2)]),t("div",dt,[t("div",ct,[e[11]||(e[11]=t("span",{class:"label"},"買入價",-1)),t("span",ut,a(s.formatPrice(s.currentPrice.buyPrice)),1)]),t("div",mt,[e[12]||(e[12]=t("span",{class:"label"},"賣出價",-1)),t("span",vt,a(s.formatPrice(s.currentPrice.sellPrice)),1)])]),t("div",yt,[t("div",bt,[e[13]||(e[13]=t("span",null,"24h 漲跌",-1)),t("span",{class:f(s.priceChange24h>=0?"positive":"negative")},a(s.priceChange24h>=0?"+":"")+a(s.priceChange24h.toFixed(2))+"% ",3)]),t("div",pt,[e[14]||(e[14]=t("span",null,"24h 成交量",-1)),t("span",null,a(s.formatVolume(s.volume24h)),1)])])])]),t("div",gt,[t("div",ft,[(d(!0),i(S,null,A(s.tradingTabs,o=>(d(),i("button",{key:o.value,class:f(["tab-btn",{active:s.activeTab===o.value}]),onClick:l=>s.activeTab=o.value},a(o.label),11,Tt))),128))]),s.activeTab==="buy"?(d(),i("div",_t,[e[21]||(e[21]=t("h3",null,"買入 USDT",-1)),t("div",St,[e[16]||(e[16]=t("label",null,"買入金額 (TWD)",-1)),t("div",At,[T(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>s.buyForm.amount=o),type:"number",placeholder:"最少 10 TWD",onInput:e[1]||(e[1]=(...o)=>s.calculateBuyAmount&&s.calculateBuyAmount(...o))},null,544),[[B,s.buyForm.amount]]),e[15]||(e[15]=t("span",{class:"currency"},"TWD",-1))]),t("div",Ft," 預計獲得: "+a(s.calculateUSDTAmount(s.buyForm.amount))+" USDT ",1)]),t("div",Bt,[e[18]||(e[18]=t("label",null,"支付方式",-1)),T(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>s.buyForm.paymentMethod=o)},[e[17]||(e[17]=t("option",{value:""},"選擇支付方式",-1)),(d(!0),i(S,null,A(s.paymentMethods,o=>(d(),i("option",{key:o.value,value:o.value},a(o.label),9,Dt))),128))],512),[[U,s.buyForm.paymentMethod]])]),t("div",kt,[t("div",ht,[e[19]||(e[19]=t("span",null,"單筆限額",-1)),t("span",null,a(s.formatPrice(s.tradingLimits.minBuy))+" - "+a(s.formatPrice(s.tradingLimits.maxBuy))+" TWD",1)]),t("div",Ct,[e[20]||(e[20]=t("span",null,"當日剩餘",-1)),t("span",null,a(s.formatPrice(s.tradingLimits.dailyRemaining))+" TWD",1)])]),t("button",{class:"trade-btn buy-btn",disabled:!s.canSubmitBuy,onClick:e[3]||(e[3]=(...o)=>s.submitBuyOrder&&s.submitBuyOrder(...o))},a(s.buyOrderLoading?"處理中...":"確認買入"),9,wt)])):O("",!0),s.activeTab==="sell"?(d(),i("div",Pt,[e[27]||(e[27]=t("h3",null,"賣出 USDT",-1)),t("div",Ot,[e[23]||(e[23]=t("label",null,"賣出數量 (USDT)",-1)),t("div",Ut,[T(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>s.sellForm.usdtAmount=o),type:"number",placeholder:"最少 1 USDT",onInput:e[5]||(e[5]=(...o)=>s.calculateSellAmount&&s.calculateSellAmount(...o))},null,544),[[B,s.sellForm.usdtAmount]]),e[22]||(e[22]=t("span",{class:"currency"},"USDT",-1))]),t("div",xt," 預計獲得: "+a(s.calculateTWDAmount(s.sellForm.usdtAmount))+" TWD ",1),t("div",Lt," 可用餘額: "+a(s.formatCrypto(s.userBalance.usdt))+" USDT ",1)]),t("div",Mt,[e[25]||(e[25]=t("label",null,"收款銀行",-1)),T(t("select",{"onUpdate:modelValue":e[6]||(e[6]=o=>s.sellForm.receivingBank=o)},[e[24]||(e[24]=t("option",{value:""},"選擇收款銀行",-1)),(d(!0),i(S,null,A(s.supportedBanks,o=>(d(),i("option",{key:o.value,value:o.value},a(o.label),9,Vt))),128))],512),[[U,s.sellForm.receivingBank]])]),t("div",It,[e[26]||(e[26]=t("label",null,"收款帳號",-1)),T(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>s.sellForm.receivingAccount=o),type:"text",placeholder:"請輸入銀行帳號"},null,512),[[B,s.sellForm.receivingAccount]])]),t("button",{class:"trade-btn sell-btn",disabled:!s.canSubmitSell,onClick:e[8]||(e[8]=(...o)=>s.submitSellOrder&&s.submitSellOrder(...o))},a(s.sellOrderLoading?"處理中...":"確認賣出"),9,Wt)])):O("",!0)]),t("div",Nt,[t("div",Et,[e[29]||(e[29]=t("h3",null,"最近訂單",-1)),$(r,{to:"/orders",class:"view-all"},{default:tt(()=>[...e[28]||(e[28]=[P("查看全部",-1)])]),_:1})]),s.recentOrders.length>0?(d(),i("div",jt,[(d(!0),i(S,null,A(s.recentOrders,o=>(d(),i("div",{key:o.id,class:"order-item",onClick:l=>y.$router.push(`/orders/${o.id}`)},[t("div",zt,[t("div",{class:f(["order-type",o.orderType.toLowerCase()])},a(o.orderType==="BUY"?"買入":"賣出"),3),t("div",Gt,[t("div",Kt,a(o.orderType==="BUY"?s.formatPrice(o.amount)+" TWD":s.formatCrypto(o.usdtAmount)+" USDT"),1),t("div",Qt,a(s.formatTime(o.createdAt)),1)])]),t("div",{class:f(["order-status",o.status.toLowerCase()])},a(s.getStatusText(o.status)),3)],8,Rt))),128))])):(d(),i("div",Yt,[...e[30]||(e[30]=[t("p",null,"暫無交易記錄",-1),t("p",{class:"suggestion"},"開始您的第一筆交易吧！",-1)])]))])])}const te=nt(ot,[["render",Ht],["__scopeId","data-v-64b0a4ec"]]);export{te as default};
