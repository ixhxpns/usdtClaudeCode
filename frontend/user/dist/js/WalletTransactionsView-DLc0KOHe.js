var be=Object.defineProperty,xe=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var we=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var Z=(g,_,c)=>_ in g?be(g,_,{enumerable:!0,configurable:!0,writable:!0,value:c}):g[_]=c,$=(g,_)=>{for(var c in _||(_={}))we.call(_,c)&&Z(g,c,_[c]);if(X)for(var c of X(_))ke.call(_,c)&&Z(g,c,_[c]);return g},j=(g,_)=>xe(g,he(_));var Y=(g,_,c)=>new Promise((S,E)=>{var n=p=>{try{h(c.next(p))}catch(D){E(D)}},d=p=>{try{h(c.throw(p))}catch(D){E(D)}},h=p=>p.done?S(p.value):Promise.resolve(p.value).then(n,d);h((c=c.apply(g,_)).next())});import{c as De,f as Ce,Z as Te,_ as Ee,X as ze,j as Ve,x as Se,h as Ne,C as Ue,ap as Be,ah as Le,P as Ye,a3 as Ie,a4 as Me,S as Ae,N as He,I as $e,J as je,K as Re,a5 as Fe,a6 as Oe,ae as Pe,ab as We,ac as Je,af as Ke,v as Qe,E as w,a1 as Ge}from"./element-plus-BimyLctg.js";import{d as Xe,aR as Ze,aQ as qe,r as C,_ as q,w as R,o as et,f as T,j as m,k as o,Q as e,H as a,Y as tt,M as u,u as I,O as r,I as at,G as k,K as x,J as ee}from"./vue-vendor-D1tpuXMX.js";import{h as lt,i as st,j as ot,k as nt}from"./wallet-Bpk4c6bO.js";import{_ as rt}from"./index-CNq4hTTw.js";import"./vendor-CPjYCZhe.js";const dt={class:"wallet-transactions-view"},it={class:"mt-6"},ct={class:"mt-6 grid grid-cols-1 md:grid-cols-4 gap-6"},ut={class:"stat-content"},pt={class:"stat-icon bg-green-100 text-green-600"},_t={class:"stat-value text-green-600"},mt={class:"stat-content"},ft={class:"stat-icon bg-red-100 text-red-600"},vt={class:"stat-value text-red-600"},gt={class:"stat-content"},yt={class:"stat-icon bg-blue-100 text-blue-600"},bt={class:"stat-value text-blue-600"},xt={class:"stat-content"},ht={class:"stat-icon bg-purple-100 text-purple-600"},wt={class:"stat-value text-purple-600"},kt={class:"mt-6"},Dt={class:"flex items-center justify-between"},Ct={class:"space-x-2"},Tt={class:"text-sm font-medium"},Et={class:"text-xs text-gray-500"},zt={class:"font-medium"},Vt={key:0,class:"text-xs text-gray-500"},St={class:"text-right"},Nt={class:"text-xs text-gray-500"},Ut={class:"text-right"},Bt={key:0,class:"text-red-600"},Lt={key:1,class:"text-gray-400"},Yt={class:"text-right font-medium"},It={class:"mt-6 flex justify-center"},Mt={key:0,class:"transaction-detail"},At={class:"font-mono"},Ht={key:0,class:"text-red-600"},$t={key:1},jt={class:"font-mono"},Rt={class:"font-mono break-all"},Ft=Xe({__name:"WalletTransactionsView",setup(g){const _=Ze();qe();const c=C(!1),S=C(!1),E=C(!1),n=C(null),d=q({type:"",currency:"",status:"",startDate:"",endDate:""}),h=C(null),p=q({page:1,size:20,total:0}),D=C([]),N=C({totalIncome:0,totalExpense:0,totalFees:0,totalCount:0});R(()=>_.query,l=>{l.type&&(d.type=l.type),f()},{immediate:!0}),R(h,l=>{l?(d.startDate=l[0],d.endDate=l[1]):(d.startDate="",d.endDate="")});const f=()=>Y(this,null,function*(){try{c.value=!0;const l=j($({},d),{page:p.page,size:p.size}),t=yield lt(l);t.data.success?(D.value=t.data.data.records,p.total=t.data.data.total):w.error(t.data.message||"获取交易记录失败")}catch(l){console.error("获取交易记录失败:",l),w.error("获取交易记录失败，请重试")}finally{c.value=!1}}),F=()=>Y(this,null,function*(){try{const l={type:d.type,currency:d.currency,startDate:d.startDate,endDate:d.endDate},t=yield st(l);t.data.success&&(N.value=t.data.data)}catch(l){console.error("获取统计数据失败:",l)}}),te=()=>{d.type="",d.currency="",d.status="",d.startDate="",d.endDate="",h.value=null,p.page=1,f()},ae=()=>Y(this,null,function*(){try{S.value=!0;const l=j($({},d),{format:"xlsx"}),t=yield ot(l);if(t.data.success){const i=URL.createObjectURL(new Blob([t.data])),y=document.createElement("a");y.href=i,y.download=`transactions_${new Date().getTime()}.xlsx`,document.body.appendChild(y),y.click(),document.body.removeChild(y),URL.revokeObjectURL(i),w.success("导出成功")}else w.error("导出失败")}catch(l){console.error("导出失败:",l),w.error("导出失败，请重试")}finally{S.value=!1}}),le=l=>{n.value=l,E.value=!0},O=l=>{const t=`https://tronscan.org/#/transaction/${l}`;window.open(t,"_blank")},se=l=>l.status==="pending"&&["withdraw","transfer"].includes(l.type),oe=l=>Y(this,null,function*(){try{if(!(yield Ge.confirm("确定要取消这笔交易吗？","取消交易",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"})))return;const i=yield nt(l.id);i.data.success?(w.success("交易已取消"),f()):w.error(i.data.message||"取消失败")}catch(t){t!=="cancel"&&(console.error("取消交易失败:",t),w.error("取消失败，请重试"))}}),A=(l,t="USDT")=>`${l.toLocaleString()} ${t}`,z=l=>l.toLocaleString(void 0,{maximumFractionDigits:8}),ne=l=>new Date(l).toLocaleDateString("zh-CN"),re=l=>new Date(l).toLocaleTimeString("zh-CN",{hour12:!1,hour:"2-digit",minute:"2-digit"}),P=l=>new Date(l).toLocaleString("zh-CN"),W=l=>({deposit:"充值",withdraw:"提现",buy:"买入",sell:"卖出",transfer:"转账",fee:"手续费",reward:"奖励",refund:"退款"})[l]||l,J=l=>({deposit:"success",withdraw:"warning",buy:"primary",sell:"danger",transfer:"info",fee:"",reward:"success",refund:"warning"})[l]||"info",K=l=>({pending:"待处理",processing:"处理中",completed:"已完成",failed:"失败",cancelled:"已取消"})[l]||l,Q=l=>({pending:"warning",processing:"info",completed:"success",failed:"danger",cancelled:"info"})[l]||"info";return et(()=>{f(),F()}),R(d,()=>{F()}),(l,t)=>{const i=Ee,y=Te,U=Ce,de=ze,B=Ve,ie=De,V=Se,L=Ne,b=Me,M=Ae,H=Re,ce=je,ue=He,pe=Ie,_e=Oe,me=Pe,v=Je,fe=Ke,ve=We,ge=Qe,ye=Fe;return m(),T("div",dt,[t[21]||(t[21]=o("div",{class:"page-header"},[o("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"交易记录"),o("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," 查看您的所有钱包交易记录 ")],-1)),o("div",it,[e(V,null,{default:a(()=>[e(ie,{model:d,inline:!0,onSubmit:tt(f,["prevent"])},{default:a(()=>[e(U,{label:"交易类型"},{default:a(()=>[e(y,{modelValue:d.type,"onUpdate:modelValue":t[0]||(t[0]=s=>d.type=s),placeholder:"全部类型",clearable:"",onChange:f},{default:a(()=>[e(i,{label:"全部",value:""}),e(i,{label:"充值",value:"deposit"}),e(i,{label:"提现",value:"withdraw"}),e(i,{label:"买入",value:"buy"}),e(i,{label:"卖出",value:"sell"}),e(i,{label:"转账",value:"transfer"}),e(i,{label:"手续费",value:"fee"})]),_:1},8,["modelValue"])]),_:1}),e(U,{label:"币种"},{default:a(()=>[e(y,{modelValue:d.currency,"onUpdate:modelValue":t[1]||(t[1]=s=>d.currency=s),placeholder:"全部币种",clearable:"",onChange:f},{default:a(()=>[e(i,{label:"全部",value:""}),e(i,{label:"USDT",value:"USDT"}),e(i,{label:"BTC",value:"BTC"}),e(i,{label:"ETH",value:"ETH"}),e(i,{label:"CNY",value:"CNY"})]),_:1},8,["modelValue"])]),_:1}),e(U,{label:"状态"},{default:a(()=>[e(y,{modelValue:d.status,"onUpdate:modelValue":t[2]||(t[2]=s=>d.status=s),placeholder:"全部状态",clearable:"",onChange:f},{default:a(()=>[e(i,{label:"全部",value:""}),e(i,{label:"待处理",value:"pending"}),e(i,{label:"处理中",value:"processing"}),e(i,{label:"已完成",value:"completed"}),e(i,{label:"失败",value:"failed"}),e(i,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"])]),_:1}),e(U,{label:"时间范围"},{default:a(()=>[e(de,{modelValue:h.value,"onUpdate:modelValue":t[3]||(t[3]=s=>h.value=s),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:f},null,8,["modelValue"])]),_:1}),e(U,null,{default:a(()=>[e(B,{type:"primary",onClick:f,loading:c.value},{default:a(()=>[...t[8]||(t[8]=[u(" 搜索 ",-1)])]),_:1},8,["loading"]),e(B,{onClick:te},{default:a(()=>[...t[9]||(t[9]=[u("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),o("div",ct,[e(V,{class:"stat-card"},{default:a(()=>[o("div",ut,[o("div",pt,[e(L,{size:24},{default:a(()=>[e(I(Ue))]),_:1})]),o("div",null,[t[10]||(t[10]=o("p",{class:"stat-label"},"总收入",-1)),o("p",_t,r(A(N.value.totalIncome)),1)])])]),_:1}),e(V,{class:"stat-card"},{default:a(()=>[o("div",mt,[o("div",ft,[e(L,{size:24},{default:a(()=>[e(I(Be))]),_:1})]),o("div",null,[t[11]||(t[11]=o("p",{class:"stat-label"},"总支出",-1)),o("p",vt,r(A(N.value.totalExpense)),1)])])]),_:1}),e(V,{class:"stat-card"},{default:a(()=>[o("div",gt,[o("div",yt,[e(L,{size:24},{default:a(()=>[e(I(Le))]),_:1})]),o("div",null,[t[12]||(t[12]=o("p",{class:"stat-label"},"手续费",-1)),o("p",bt,r(A(N.value.totalFees)),1)])])]),_:1}),e(V,{class:"stat-card"},{default:a(()=>[o("div",xt,[o("div",ht,[e(L,{size:24},{default:a(()=>[e(I(Ye))]),_:1})]),o("div",null,[t[13]||(t[13]=o("p",{class:"stat-label"},"交易笔数",-1)),o("p",wt,r(N.value.totalCount),1)])])]),_:1})]),o("div",kt,[e(V,null,{header:a(()=>[o("div",Dt,[t[16]||(t[16]=o("span",{class:"text-lg font-medium"},"交易记录",-1)),o("div",Ct,[e(B,{onClick:ae,loading:S.value},{default:a(()=>[...t[14]||(t[14]=[u(" 导出记录 ",-1)])]),_:1},8,["loading"]),e(B,{onClick:f,loading:c.value},{default:a(()=>[...t[15]||(t[15]=[u(" 刷新 ",-1)])]),_:1},8,["loading"])])])]),default:a(()=>[at((m(),k(pe,{data:D.value,style:{width:"100%"},"row-key":"id"},{default:a(()=>[e(b,{prop:"createdAt",label:"时间",width:"180",sortable:""},{default:a(({row:s})=>[o("div",null,[o("div",Tt,r(ne(s.createdAt)),1),o("div",Et,r(re(s.createdAt)),1)])]),_:1}),e(b,{prop:"type",label:"类型",width:"100"},{default:a(({row:s})=>[e(M,{type:J(s.type),effect:"light",size:"small"},{default:a(()=>[u(r(W(s.type)),1)]),_:2},1032,["type"])]),_:1}),e(b,{prop:"description",label:"描述","min-width":"200"},{default:a(({row:s})=>[o("div",null,[o("div",zt,r(s.description),1),s.orderNumber?(m(),T("div",Vt," 订单号: "+r(s.orderNumber),1)):x("",!0)])]),_:1}),e(b,{prop:"currency",label:"币种",width:"80"}),e(b,{prop:"amount",label:"金额",width:"150"},{default:a(({row:s})=>[o("div",St,[o("div",{class:ee(["font-medium",{"text-green-600":s.direction==="in","text-red-600":s.direction==="out"}])},r(s.direction==="in"?"+":"-")+r(z(s.amount)),3),o("div",Nt,r(s.currency),1)])]),_:1}),e(b,{prop:"fee",label:"手续费",width:"120"},{default:a(({row:s})=>[o("div",Ut,[s.fee>0?(m(),T("span",Bt," -"+r(z(s.fee)),1)):(m(),T("span",Lt,"-"))])]),_:1}),e(b,{prop:"balance",label:"余额",width:"150"},{default:a(({row:s})=>[o("div",Yt,r(z(s.balanceAfter)),1)]),_:1}),e(b,{prop:"status",label:"状态",width:"100"},{default:a(({row:s})=>[e(M,{type:Q(s.status),effect:"light",size:"small"},{default:a(()=>[u(r(K(s.status)),1)]),_:2},1032,["type"])]),_:1}),e(b,{label:"操作",width:"120",fixed:"right"},{default:a(({row:s})=>[e(ue,{trigger:"click"},{dropdown:a(()=>[e(ce,null,{default:a(()=>[e(H,{onClick:G=>le(s)},{default:a(()=>[...t[18]||(t[18]=[u(" 查看详情 ",-1)])]),_:2},1032,["onClick"]),s.txHash?(m(),k(H,{key:0,onClick:G=>O(s.txHash)},{default:a(()=>[...t[19]||(t[19]=[u(" 区块链浏览器 ",-1)])]),_:2},1032,["onClick"])):x("",!0),se(s)?(m(),k(H,{key:1,onClick:G=>oe(s),divided:""},{default:a(()=>[...t[20]||(t[20]=[u(" 取消交易 ",-1)])]),_:2},1032,["onClick"])):x("",!0)]),_:2},1024)]),default:a(()=>[e(B,{text:"",type:"primary"},{default:a(()=>[t[17]||(t[17]=u(" 更多 ",-1)),e(L,null,{default:a(()=>[e(I($e))]),_:1})]),_:1})]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[ye,c.value]]),o("div",It,[e(_e,{"current-page":p.page,"onUpdate:currentPage":t[4]||(t[4]=s=>p.page=s),"page-size":p.size,"onUpdate:pageSize":t[5]||(t[5]=s=>p.size=s),"page-sizes":[10,20,50,100],total:p.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:f,onCurrentChange:f},null,8,["current-page","page-size","total"])]),!c.value&&D.value.length===0?(m(),k(me,{key:0,description:"暂无交易记录","image-size":200})):x("",!0)]),_:1})]),e(ge,{modelValue:E.value,"onUpdate:modelValue":t[7]||(t[7]=s=>E.value=s),title:"交易详情",width:"600px",center:""},{default:a(()=>[n.value?(m(),T("div",Mt,[e(ve,{column:2,border:""},{default:a(()=>[e(v,{label:"交易ID",span:"2"},{default:a(()=>[o("span",At,r(n.value.id),1)]),_:1}),e(v,{label:"交易类型"},{default:a(()=>[e(M,{type:J(n.value.type)},{default:a(()=>[u(r(W(n.value.type)),1)]),_:1},8,["type"])]),_:1}),e(v,{label:"状态"},{default:a(()=>[e(M,{type:Q(n.value.status)},{default:a(()=>[u(r(K(n.value.status)),1)]),_:1},8,["type"])]),_:1}),e(v,{label:"币种"},{default:a(()=>[u(r(n.value.currency),1)]),_:1}),e(v,{label:"金额"},{default:a(()=>[o("span",{class:ee({"text-green-600":n.value.direction==="in","text-red-600":n.value.direction==="out"})},r(n.value.direction==="in"?"+":"-")+r(z(n.value.amount)),3)]),_:1}),e(v,{label:"手续费"},{default:a(()=>[n.value.fee>0?(m(),T("span",Ht,r(z(n.value.fee)),1)):(m(),T("span",$t,"-"))]),_:1}),e(v,{label:"交易后余额"},{default:a(()=>[u(r(z(n.value.balanceAfter)),1)]),_:1}),e(v,{label:"创建时间"},{default:a(()=>[u(r(P(n.value.createdAt)),1)]),_:1}),e(v,{label:"完成时间"},{default:a(()=>[u(r(n.value.completedAt?P(n.value.completedAt):"-"),1)]),_:1}),n.value.orderNumber?(m(),k(v,{key:0,label:"订单号"},{default:a(()=>[o("span",jt,r(n.value.orderNumber),1)]),_:1})):x("",!0),n.value.txHash?(m(),k(v,{key:1,label:"交易哈希"},{default:a(()=>[e(fe,{type:"primary",onClick:t[6]||(t[6]=s=>O(n.value.txHash)),class:"font-mono"},{default:a(()=>[u(r(n.value.txHash),1)]),_:1})]),_:1})):x("",!0),n.value.address?(m(),k(v,{key:2,label:"地址信息",span:"2"},{default:a(()=>[o("span",Rt,r(n.value.address),1)]),_:1})):x("",!0),n.value.remark?(m(),k(v,{key:3,label:"备注",span:"2"},{default:a(()=>[u(r(n.value.remark),1)]),_:1})):x("",!0)]),_:1})])):x("",!0)]),_:1},8,["modelValue"])])}}}),Gt=rt(Ft,[["__scopeId","data-v-aa9486b8"]]);export{Gt as default};
